[{"content":"UDP打洞（UDP Hole Punching）是一种常用于穿越NAT（Network Address Translation，网络地址转换）设备的技术，使位于不同内网的两个设备能够建立直接的UDP通信通道。UDP打洞常应用于P2P网络和需要低延迟通信的应用中，如视频通话和实时游戏。下面是UDP打洞的基本原理和完整流程。\n1. UDP打洞原理 UDP打洞利用了NAT的特性，即NAT设备会在设备A发出一个UDP包时，在公网和私网之间建立临时的端口映射，允许外部设备通过这个端口与设备A进行通信。关键原理在于双方设备都先向第三方服务器发送UDP请求，服务器记录下双方的公网IP和端口，再将此信息相互发送给对方，双方设备再使用这些信息向对方发包进行直接通信。\n2. UDP打洞的完整流程 假设两台设备分别是客户端A和客户端B，目标是让它们在各自的NAT后建立直接的UDP通信通道。过程分为以下几个步骤：\n步骤 1：准备一个中继服务器（称为“信令服务器”或“中继服务器”） 信令服务器是公网服务器，通常拥有一个固定的公网IP，用来帮助设备A和设备B进行初步的通信。 该服务器的作用是让A和B双方获取对方的公网IP和端口，并不负责实际的通信数据传输。 步骤 2：客户端A和客户端B分别向信令服务器注册 A和B同时向信令服务器发送一个UDP包，请求注册自己的公网IP和端口。 NAT设备会为A和B分别在公网分配一个外部IP和端口，用来映射A和B各自的私有IP和端口。 信令服务器记录下每个设备的公网IP和端口。假设信令服务器接收到： A的公网IP和端口为 A_pub_IP:A_pub_port。 B的公网IP和端口为 B_pub_IP:B_pub_port。 步骤 3：信令服务器将A和B的公网信息互发 信令服务器将B的公网信息 B_pub_IP:B_pub_port 发送给A，同时将A的公网信息 A_pub_IP:A_pub_port 发送给B。 A和B现在知道了对方的公网IP和端口。 步骤 4：客户端A和客户端B向对方发送UDP包 A和B同时向对方的公网IP和端口发送一个UDP包，以触发NAT映射。此包的内容可以是一个“打洞”请求或任意数据包。 NAT会将A发往 B_pub_IP:B_pub_port 的请求映射到B的内网地址，并且创建从 B_pub_port 到A的端口映射。 同理，B发往 A_pub_IP:A_pub_port 的请求会触发A端NAT的相应映射。 步骤 5：A和B接收对方发来的UDP包，完成连接 如果打洞请求成功，A和B都能收到对方发来的UDP包，此时双方建立了直接的通信通道。 后续的通信数据可以通过该通道直接发送和接收。 3. 关键技术点和常见问题 NAT类型兼容性：UDP打洞对NAT类型有一定的要求，效果在“全锥形NAT”和“受限锥形NAT”下最佳。对称NAT（Symmetric NAT）中UDP打洞成功率较低，因为其端口映射非常严格。 打洞失败的处理：如果直接通信无法建立，可以尝试使用信令服务器进行中继，以保证通信的可靠性。 打洞时序控制：为了增加成功率，A和B最好同时发起打洞请求，减少映射失效的风险。 超时机制：NAT设备的端口映射通常有超时时间，因此需要周期性地发送空UDP包来保持连接活跃。 4. 简单的代码示例 可以用Python的socket库来模拟打洞流程。这个示例演示了信令服务器记录两个客户端的公网IP和端口，并将其传递给对方。实际生产代码应加入更多的错误处理和超时管理。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 # 信令服务器代码 import socket def signaling_server(): server_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM) server_socket.bind((\u0026#34;0.0.0.0\u0026#34;, 12345)) print(\u0026#34;Signaling server is running on port 12345...\u0026#34;) clients = {} while True: data, addr = server_socket.recvfrom(1024) clients[addr] = data.decode() if len(clients) == 2: addrs = list(clients.keys()) server_socket.sendto(f\u0026#34;{addrs[1][0]}:{addrs[1][1]}\u0026#34;.encode(), addrs[0]) server_socket.sendto(f\u0026#34;{addrs[0][0]}:{addrs[0][1]}\u0026#34;.encode(), addrs[1]) clients.clear() # 客户端代码 def client(name): client_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM) client_socket.sendto(name.encode(), (\u0026#34;信令服务器IP\u0026#34;, 12345)) # 接收对方的公网IP和端口 data, _ = client_socket.recvfrom(1024) peer_ip, peer_port = data.decode().split(\u0026#34;:\u0026#34;) peer_addr = (peer_ip, int(peer_port)) # 向对方发送打洞包 client_socket.sendto(f\u0026#34;Hello from {name}\u0026#34;.encode(), peer_addr) # 接收对方的响应 response, _ = client_socket.recvfrom(1024) print(f\u0026#34;Received response from {peer_addr}: {response.decode()}\u0026#34;) # 运行示例 if __name__ == \u0026#34;__main__\u0026#34;: # 启动信令服务器 import threading threading.Thread(target=signaling_server, daemon=True).start() # 启动两个客户端 threading.Thread(target=client, args=(\u0026#34;Client A\u0026#34;,)).start() threading.Thread(target=client, args=(\u0026#34;Client B\u0026#34;,)).start() 5. 总结 UDP打洞可以高效地穿越NAT来实现内网之间的直接通信。该技术通常需要外部信令服务器的辅助，以及对NAT类型的兼容性测试。尽管存在某些限制，UDP打洞在大部分NAT环境下都能实现稳定的P2P通信。\n","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/network/knowledge/udp%E6%89%93%E6%B4%9E%E5%8E%9F%E7%90%86%E5%8F%8A%E6%B5%81%E7%A8%8B/","summary":"\u003cp\u003eUDP打洞（UDP Hole Punching）是一种常用于穿越NAT（Network Address Translation，网络地址转换）设备的技术，使位于不同内网的两个设备能够建立直接的UDP通信通道。UDP打洞常应用于P2P网络和需要低延迟通信的应用中，如视频通话和实时游戏。下面是UDP打洞的基本原理和完整流程。\u003c/p\u003e","title":"UDP打洞原理及流程"},{"content":"安装 Windows \u0026amp; MacOS 直接去 Github 上下载安装包\nUbuntu 1 sudo apt install barrier 设置 服务端设置 “设置服务端” 在里边新增屏幕，名字用客户端的设置名字（不能自己随便给，看客户端的设置里）\n关闭SSL 防火墙允许端口 客户端设置 关闭ssl 设置服务端ip 常见问题 Ubuntu 无法启动，提示Wayland问题 日志告警：WARNING: cursor may not be visible 也用该方法解决\n修改 /etc/gdm3/custom.conf\n1 2 #取消注释 #WaylandEnable=false 1 sudo systemctl restart gdm3 客户端无法连接服务端，日志显示一直在尝试连接，但是连接超时 检查客户端和服务端都关闭ssl 点击设置服务端按钮，进入有小电脑的配置页面 删除旧的客户端小电脑，如果没有，直接进入第三步新增 新增客户端小电脑，屏幕名命名为ubuntu的用户名 服务端客户端切换之后鼠标锁死无法移动 解决方案：屏蔽缩放都调整为100%\n服务端控制后，鼠标进入ubuntu桌面后看不到光标 ","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/open_source_favorites/%E4%BA%92%E8%81%94barrier/","summary":"\u003ch2 id=\"安装\"\u003e安装\u003c/h2\u003e\n\u003ch3 id=\"windows--macos\"\u003eWindows \u0026amp; MacOS\u003c/h3\u003e\n\u003cp\u003e直接去 Github 上下载\u003ca href=\"https://github.com/debauchee/barrier/releases\"\u003e安装包\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"ubuntu\"\u003eUbuntu\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt install barrier\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"设置\"\u003e设置\u003c/h2\u003e\n\u003ch3 id=\"服务端设置\"\u003e服务端设置\u003c/h3\u003e\n\u003ch4 id=\"设置服务端\"\u003e“设置服务端”\u003c/h4\u003e\n\u003cp\u003e在里边新增屏幕，名字用客户端的设置名字（不能自己随便给，看客户端的设置里）\u003c/p\u003e\n\u003ch4 id=\"关闭ssl\"\u003e关闭SSL\u003c/h4\u003e\n\u003ch4 id=\"防火墙允许端口\"\u003e防火墙允许端口\u003c/h4\u003e\n\u003ch3 id=\"客户端设置\"\u003e客户端设置\u003c/h3\u003e\n\u003ch4 id=\"关闭ssl-1\"\u003e关闭ssl\u003c/h4\u003e\n\u003ch4 id=\"设置服务端ip\"\u003e设置服务端ip\u003c/h4\u003e\n\u003ch2 id=\"常见问题\"\u003e常见问题\u003c/h2\u003e\n\u003ch3 id=\"ubuntu-无法启动提示wayland问题\"\u003eUbuntu 无法启动，提示Wayland问题\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e日志告警：WARNING: cursor may not be visible\n也用该方法解决\u003c/p\u003e","title":"互联Barrier安装记录"},{"content":" 主要用于寻找第三方库后做备忘的零散记录，常用库此处不记录\nRust deno: 类似nodejs nom: 解析库（包括但不限于语法） egui、Tauri、Iced: GUI框架：https://rustcc.cn/article?id=8f6c816e-790e-44ff-8c80-1a0b8154fb7d\npingora 类似nginx\n加密库 aes等加密以及ed25519等签名校验常用ring rustls、rust-openssl、ring\nJS相关 https://github.com/yuankunzhang/charming : 通过deno_core调用echarts生成图表 https://github.com/rscarson/rustyscript : deno_core的上层封装\nboa_engine : 一个实验性Js引擎，rust实现\nJava javalin: 非常轻量级的web框架（java或kotlin） vertx: 响应式 网络框架集 包括但不限于web quarkus: 全栈Kubernetes原生Java框架，专为GraalVM和HotSpot优化，底层使用的反应式框架之一是vertx\n浏览器自动化 一、Playwright vs Puppeteer 核心对比 对比维度 Puppeteer Playwright 浏览器支持 主攻 Chromium，有限支持 Firefox（功能不全） 原生支持 Chromium、Firefox、WebKit（Safari） API 设计 需手动等待元素状态（如 waitForSelector） 自动等待元素可交互（如点击前检查可见性） 性能表现 冷启动约 1.2 秒，内存占用较低 冷启动约 0.8 秒（连接池优化），支持并行上下文隔离 高级功能 - PDF 生成质量更高- 截图速度快 15-20% - 移动设备模拟（精确视口/触摸事件）- 视频录制、网络请求拦截- 跨 iframe 操作 多语言支持 Node.js 为主，社区提供非官方 Python 库 官方支持：JavaScript/TypeScript、Python、Java、C# 适用场景 - 仅需覆盖 Chromium 系浏览器 - 轻量级部署或高质量 PDF 生成- 跨浏览器测试（含 Safari）- 复杂自动化（移动端模拟、视频录制）- 多语言团队协作 选型建议：\n选 Puppeteer：项目深度绑定 Chromium 生态，追求轻量部署或高质量 PDF/截图生成。 选 Playwright：需覆盖 Safari/Firefox、实现复杂自动化（如移动端测试），或团队使用多语言开发。 ","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/open_source_favorites/open_source_lib/","summary":"\u003cblockquote\u003e\n\u003cp\u003e主要用于寻找第三方库后做备忘的零散记录，常用库此处不记录\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch1 id=\"rust\"\u003eRust\u003c/h1\u003e\n\u003cp\u003edeno: 类似nodejs\nnom: 解析库（包括但不限于语法）\negui、Tauri、Iced: GUI框架：https://rustcc.cn/article?id=8f6c816e-790e-44ff-8c80-1a0b8154fb7d\u003c/p\u003e","title":"开源库搜寻记录"},{"content":" 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 #!/bin/sh datastore_path=/vmfs/volumes/datastore1 template_name=CentOS-Base-250609 nts_template_path=\u0026#34;$datastore_path/$template_name\u0026#34; new_path=$datastore_path/$1 if [ -d \u0026#34;$new_path\u0026#34; ]; then echo \u0026#34;exists vm : $1\u0026#34; exit 1 fi mkdir $new_path echo \u0026#34;clone vmdk...\u0026#34; vmkfstools -i $nts_template_path/$template_name.vmdk $new_path/$1.vmdk -d eagerzeroedthick echo \u0026#34;clone vmdk2...\u0026#34; vmkfstools -i $nts_template_path/${template_name}_1.vmdk $new_path/$1_1.vmdk -d zeroedthick echo \u0026#34;generate vmx...\u0026#34; cp $nts_template_path/$template_name.vmx $new_path/$1.vmx sed -i \u0026#39;/ethernet[0-9]\\.generatedAddress/d\u0026#39; $new_path/$1.vmx sed -i \u0026#39;/annotation = \u0026#34;/d\u0026#39; $new_path/$1.vmx sed -i \u0026#39;/scsi[0-9]\\.sasWWID = \u0026#34;/d\u0026#39; $new_path/$1.vmx sed -i \u0026#39;/sched\\.swap\\.derivedName = \u0026#34;/d\u0026#39; $new_path/$1.vmx sed -i \u0026#39;/migrate\\.hostlog = \u0026#34;/d\u0026#39; $new_path/$1.vmx sed -i \u0026#39;/nvram = \u0026#34;/d\u0026#39; $new_path/$1.vmx sed -i \u0026#39;/vc\\.uuid = \u0026#34;/d\u0026#39; $new_path/$1.vmx sed -i \u0026#39;/uuid\\.location = \u0026#34;/d\u0026#39; $new_path/$1.vmx sed -i \u0026#39;/uuid\\.bios = \u0026#34;/d\u0026#39; $new_path/$1.vmx sed -i \u0026#34;/displayName = \\\u0026#34;/c\\displayName = \\\u0026#34;$1\\\u0026#34;\u0026#34; $new_path/$1.vmx # custom disk file and ethernet sed -i \u0026#34;/scsi0:0\\.fileName = \\\u0026#34;/c\\scsi0:0.fileName = \\\u0026#34;$1.vmdk\\\u0026#34;\u0026#34; $new_path/$1.vmx sed -i \u0026#34;/scsi0:1\\.fileName = \\\u0026#34;/c\\scsi0:1.fileName = \\\u0026#34;$1_1.vmdk\\\u0026#34;\u0026#34; $new_path/$1.vmx if [ -n \u0026#34;$2\u0026#34; ]; then sed -i \u0026#39;/ethernet0\\.addressType = \u0026#34;/c\\ethernet0.addressType = \u0026#34;static\u0026#34;\u0026#39; $new_path/$1.vmx sed -i \u0026#34;/ethernet0\\.address = \\\u0026#34;/c\\ethernet0.address = \\\u0026#34;$2\\\u0026#34;\u0026#34; $new_path/$1.vmx else sed -i \u0026#39;/ethernet0\\.addressType = \u0026#34;/c\\ethernet0.addressType = \u0026#34;generated\u0026#34;\u0026#39; $new_path/$1.vmx sed -i \u0026#34;/ethernet0\\.address = \\\u0026#34;/d\u0026#34; $new_path/$1.vmx fi echo \u0026#34;register vm...\u0026#34; vim-cmd solo/registervm $new_path/$1.vmx echo \u0026#34;over.\u0026#34; ","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/linux/esxi7%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%85%8B%E9%9A%86%E8%84%9A%E6%9C%AC%E5%AE%9E%E7%8E%B0/","summary":"\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e42\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\u003cspan class=\"nv\"\u003edatastore_path\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/vmfs/volumes/datastore1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003etemplate_name\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eCentOS-Base-250609\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ents_template_path\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$datastore_path\u003c/span\u003e\u003cspan class=\"s2\"\u003e/\u003c/span\u003e\u003cspan class=\"nv\"\u003e$template_name\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003enew_path\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$datastore_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e -d \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;exists vm : \u003c/span\u003e\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;clone vmdk...\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evmkfstools -i \u003cspan class=\"nv\"\u003e$nts_template_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$template_name\u003c/span\u003e.vmdk \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.vmdk -d eagerzeroedthick\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;clone vmdk2...\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evmkfstools -i \u003cspan class=\"nv\"\u003e$nts_template_path\u003c/span\u003e/\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003etemplate_name\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e_1.vmdk \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e_1.vmdk -d zeroedthick\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;generate vmx...\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecp \u003cspan class=\"nv\"\u003e$nts_template_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$template_name\u003c/span\u003e.vmx \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.vmx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s1\"\u003e\u0026#39;/ethernet[0-9]\\.generatedAddress/d\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.vmx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s1\"\u003e\u0026#39;/annotation = \u0026#34;/d\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.vmx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s1\"\u003e\u0026#39;/scsi[0-9]\\.sasWWID = \u0026#34;/d\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.vmx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s1\"\u003e\u0026#39;/sched\\.swap\\.derivedName = \u0026#34;/d\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.vmx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s1\"\u003e\u0026#39;/migrate\\.hostlog = \u0026#34;/d\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.vmx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s1\"\u003e\u0026#39;/nvram = \u0026#34;/d\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.vmx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s1\"\u003e\u0026#39;/vc\\.uuid = \u0026#34;/d\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.vmx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s1\"\u003e\u0026#39;/uuid\\.location = \u0026#34;/d\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.vmx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s1\"\u003e\u0026#39;/uuid\\.bios = \u0026#34;/d\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.vmx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s2\"\u003e\u0026#34;/displayName = \\\u0026#34;/c\\displayName = \\\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e\u003cspan class=\"s2\"\u003e\\\u0026#34;\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.vmx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# custom disk file and ethernet\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s2\"\u003e\u0026#34;/scsi0:0\\.fileName = \\\u0026#34;/c\\scsi0:0.fileName = \\\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e\u003cspan class=\"s2\"\u003e.vmdk\\\u0026#34;\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.vmx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s2\"\u003e\u0026#34;/scsi0:1\\.fileName = \\\u0026#34;/c\\scsi0:1.fileName = \\\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e\u003cspan class=\"s2\"\u003e_1.vmdk\\\u0026#34;\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.vmx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e -n \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$2\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  sed -i \u003cspan class=\"s1\"\u003e\u0026#39;/ethernet0\\.addressType = \u0026#34;/c\\ethernet0.addressType = \u0026#34;static\u0026#34;\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.vmx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  sed -i \u003cspan class=\"s2\"\u003e\u0026#34;/ethernet0\\.address = \\\u0026#34;/c\\ethernet0.address = \\\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$2\u003c/span\u003e\u003cspan class=\"s2\"\u003e\\\u0026#34;\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.vmx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  sed -i \u003cspan class=\"s1\"\u003e\u0026#39;/ethernet0\\.addressType = \u0026#34;/c\\ethernet0.addressType = \u0026#34;generated\u0026#34;\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.vmx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  sed -i \u003cspan class=\"s2\"\u003e\u0026#34;/ethernet0\\.address = \\\u0026#34;/d\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.vmx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;register vm...\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evim-cmd solo/registervm \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.vmx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;over.\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"ESXi7虚拟机克隆脚本实现"},{"content":"修改说明地址 https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/\nmirror https://mirrors.tuna.tsinghua.edu.cn/ubuntu\n","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/linux/ubuntu%E6%B8%85%E5%8D%8E%E6%BA%90/","summary":"\u003ch2 id=\"修改说明地址\"\u003e修改说明地址\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/\"\u003ehttps://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"mirror\"\u003emirror\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://mirrors.tuna.tsinghua.edu.cn/ubuntu\"\u003ehttps://mirrors.tuna.tsinghua.edu.cn/ubuntu\u003c/a\u003e\u003c/p\u003e","title":"Ubuntu清华源配置"},{"content":"Ubuntu win 双系统 时间 要解决 Ubuntu 与 Windows 双系统时间不同步，可以按照以下步骤操作：\n打开终端，编辑 /etc/default/rcS 文件，将 “ UTC=yes ” 改成 “ UTC=no ”。 重启进入 Ubuntu 系统，设置好时间。 进入 Windows 系统即可解决时间问题1。或者，也可以在 Windows 系统中使用命令提示符输入 Reg add HKLMSYSTEMCurrentControlSetControl[\u0026amp;Time\u0026amp;]ZoneInformation /v RealTimeIsUniversal /t REG_DWORD /d 1，然后重启进入 Ubuntu 系统 Ubuntu24 解决办法 由于ubuntu24弃用了hwclock，所以不能使用上述方法解决，需要使用如下解决：\n1 sudo timedatectl set-local-rtc 1 ","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/linux/%E5%8F%8C%E7%B3%BB%E7%BB%9F%E6%97%B6%E9%97%B4%E9%97%AE%E9%A2%98/","summary":"\u003ch2 id=\"ubuntu-win-双系统-时间\"\u003eUbuntu win 双系统 时间\u003c/h2\u003e\n\u003cp\u003e要解决 Ubuntu 与 Windows 双系统时间不同步，可以按照以下步骤操作：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e打开终端，编辑 /etc/default/rcS 文件，将 “ UTC=yes ” 改成 “ UTC=no ”。\u003c/li\u003e\n\u003cli\u003e重启进入 Ubuntu 系统，设置好时间。\u003c/li\u003e\n\u003cli\u003e进入 Windows 系统即可解决时间问题1。或者，也可以在 Windows 系统中使用命令提示符输入 \u003ccode\u003eReg add HKLMSYSTEMCurrentControlSetControl[\u0026amp;Time\u0026amp;]ZoneInformation /v RealTimeIsUniversal /t REG_DWORD /d 1\u003c/code\u003e，然后重启进入 Ubuntu 系统\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"ubuntu24-解决办法\"\u003eUbuntu24 解决办法\u003c/h3\u003e\n\u003cp\u003e由于ubuntu24弃用了hwclock，所以不能使用上述方法解决，需要使用如下解决：\u003c/p\u003e","title":"双系统时间问题"},{"content":"1. 配置网卡 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 编辑网络配置文件 sudo vi /etc/sysconfig/network-scripts/ifcfg-ens1 # 内容如下（示例IP，根据实际情况修改）： DEVICE=ens1 BOOTPROTO=dhcp # 或静态IP（需与物理网络同网段） ONBOOT=yes sudo vi /etc/sysconfig/network-scripts/ifcfg-ens2 # 内容如下： DEVICE=ens2 BOOTPROTO=static IPADDR=192.168.10.1 NETMASK=255.255.255.0 ONBOOT=yes 2. 启用IP转发 1 2 3 4 5 sudo vi /etc/sysctl.conf # 取消注释或添加： net.ipv4.ip_forward = 1 # 生效配置 sudo sysctl -p 3. 配置防火墙/NAT 1 2 3 4 5 # 使用firewalld配置 sudo firewall-cmd --permanent --zone=public --add-interface=ens1 sudo firewall-cmd --permanent --zone=internal --add-interface=ens2 sudo firewall-cmd --permanent --zone=public --add-masquerade sudo firewall-cmd --reload 或使用iptables（如果未使用firewalld） 1 2 3 4 5 6 # 或使用iptables（如果未使用firewalld） sudo iptables -t nat -A POSTROUTING -o ens1 -j MASQUERADE sudo iptables -A FORWARD -i ens2 -j ACCEPT # 保存规则（需安装iptables-services） sudo service iptables save sudo systemctl restart iptables DHCP服务 1 sudo yum install dhcp -y 配置dhcp 1 sudo vi /etc/dhcp/dhcpd.conf 1 2 3 4 5 6 7 8 9 10 11 12 # 定义DHCP全局选项（可选） option domain-name \u0026#34;internal.net\u0026#34;; option domain-name-servers 8.8.8.8, 8.8.4.4; # DNS服务器 default-lease-time 600; # 默认租约时间（秒） max-lease-time 7200; # 最大租约时间 # 定义子网段 subnet 192.168.10.0 netmask 255.255.255.0 { range 192.168.10.100 192.168.10.200; # 分配的IP范围 option routers 192.168.10.1; # 网关（指向虚拟机A的ens2） option subnet-mask 255.255.255.0; } 指定DHCP监听的接口 1 sudo vi /etc/sysconfig/dhcpd 1 DHCPDARGS=\u0026#34;ens2\u0026#34; # 仅监听内部网络接口 启动DHCP服务并设置开机自启 1 2 sudo systemctl start dhcpd sudo systemctl enable dhcpd 防火墙放行DHCP流量 1 2 sudo firewall-cmd --permanent --add-service=dhcp sudo firewall-cmd --reload ","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/linux/linux%E4%BD%9C%E4%B8%BA%E7%BD%91%E5%85%B3%E6%8F%90%E4%BE%9B%E8%B7%AF%E7%94%B1/","summary":"\u003ch2 id=\"1-配置网卡\"\u003e1. 配置网卡\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# 编辑网络配置文件\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo vi /etc/sysconfig/network-scripts/ifcfg-ens1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# 内容如下（示例IP，根据实际情况修改）：\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDEVICE=ens1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBOOTPROTO=dhcp  # 或静态IP（需与物理网络同网段）\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eONBOOT=yes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo vi /etc/sysconfig/network-scripts/ifcfg-ens2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# 内容如下：\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDEVICE=ens2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBOOTPROTO=static\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eIPADDR=192.168.10.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNETMASK=255.255.255.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eONBOOT=yes\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-启用ip转发\"\u003e2. 启用IP转发\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo vi /etc/sysctl.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# 取消注释或添加：\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.ip_forward = 1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# 生效配置\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo sysctl -p\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"3-配置防火墙nat\"\u003e3. 配置防火墙/NAT\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-gdscript3\" data-lang=\"gdscript3\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 使用firewalld配置\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003esudo\u003c/span\u003e \u003cspan class=\"n\"\u003efirewall\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ecmd\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003epermanent\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003ezone\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003epublic\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003einterface\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eens1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003esudo\u003c/span\u003e \u003cspan class=\"n\"\u003efirewall\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ecmd\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003epermanent\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003ezone\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003einternal\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003einterface\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eens2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003esudo\u003c/span\u003e \u003cspan class=\"n\"\u003efirewall\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ecmd\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003epermanent\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003ezone\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003epublic\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003emasquerade\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003esudo\u003c/span\u003e \u003cspan class=\"n\"\u003efirewall\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ecmd\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003ereload\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e或使用iptables（如果未使用firewalld）\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# 或使用iptables（如果未使用firewalld）\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo iptables -t nat -A POSTROUTING -o ens1 -j MASQUERADE\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo iptables -A FORWARD -i ens2 -j ACCEPT\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# 保存规则（需安装iptables-services）\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo service iptables save\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo systemctl restart iptables\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"dhcp服务\"\u003eDHCP服务\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo yum install dhcp -y\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e配置dhcp\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo vi /etc/dhcp/dhcpd.conf\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# 定义DHCP全局选项（可选）\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eoption domain-name \u0026#34;internal.net\u0026#34;;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eoption domain-name-servers 8.8.8.8, 8.8.4.4;  # DNS服务器\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edefault-lease-time 600;                        # 默认租约时间（秒）\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emax-lease-time 7200;                           # 最大租约时间\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# 定义子网段\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esubnet 192.168.10.0 netmask 255.255.255.0 {\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    range 192.168.10.100 192.168.10.200;       # 分配的IP范围\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    option routers 192.168.10.1;               # 网关（指向虚拟机A的ens2）\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    option subnet-mask 255.255.255.0;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e指定DHCP监听的接口\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo vi /etc/sysconfig/dhcpd\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDHCPDARGS=\u0026#34;ens2\u0026#34;  # 仅监听内部网络接口\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e启动DHCP服务并设置开机自启\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo systemctl start dhcpd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo systemctl enable dhcpd\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e防火墙放行DHCP流量\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-gdscript3\" data-lang=\"gdscript3\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003esudo\u003c/span\u003e \u003cspan class=\"n\"\u003efirewall\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ecmd\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003epermanent\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eservice\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003edhcp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003esudo\u003c/span\u003e \u003cspan class=\"n\"\u003efirewall\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ecmd\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003ereload\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"linux作为网关提供路由"},{"content":" https://www.cnblogs.com/aresxin/p/17864829.html\n开启内核转发 1 2 3 4 5 6 7 8 # tail -6 /etc/sysctl.conf net.ipv4.ip_forward=1 net.ipv6.conf.all.forwarding=1 net.ipv4.conf.all.accept_redirects = 0 net.ipv6.conf.all.accept_redirects = 0 # sysctl -p ipsec.conf配置 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 # cat /etc/ipsec.conf config setup charondebug=\u0026#34;ike 1, knl 1, cfg 0, net 1\u0026#34; strictcrlpolicy=no uniqueids=yes # 如果同一个用户在不同的设备上重复登录,yes 断开旧连接,创建新连接;no 保持旧连接,并发送通知; never 同 no, 但不发送通知. cachecrls=no conn ipsec-ikev2-vpn #XAUTH认证需要 auto=add\t# 当服务启动时, 应该如何处理这个连接项,add 添加到连接表中 compress=no\t# 是否启用压缩, yes 表示如果支持压缩会启用 type=tunnel\tkeyexchange=ikev2 fragmentation=yes forceencaps=yes dpdaction=clear\t# 当意外断开后尝试的操作 dpddelay=300s\t# dpd时间间隔 rekey=no\t# 不自动重置密钥 left=%any\t# 服务器端标识，可以是魔术字 %any，表示从本地ip地址表中取 leftid=123.13.12.1\t# 服务器端ID标识,这里为你的公网ip，或者@你的域名 leftcert=server.cert.pem\t# 服务器端证书 leftsendcert=always\t# 是否发送服务器证书到客户端 leftsubnet=0.0.0.0/0 right=%any\t# 客户端标识，%any表示任意 rightid=%any rightauth=eap-mschapv2\t#KEv2 EAP(Username/Password) rightsourceip=192.168.137.0/24 # 客户端IP地址分配范围 rightdns=223.5.5.5,223.6.6.6\t# DNS rightsendcert=never\t# 客户端不发送证书 eap_identity=%identity\t# 指定客户端eap id ike=chacha20poly1305-sha512-curve25519-prfsha512,aes256gcm16-sha384-prfsha384-ecp384,aes256-sha1-modp1024,aes128-sha1-modp1024,3des-sha1-modp1024!\t# 密钥交换协议加密算法列表，可以包括多个算法和协议。 esp=chacha20poly1305-sha512,aes256gcm16-ecp384,aes256-sha256,aes256-sha1,3des-sha1!\t# 数据传输协议加密算法列表,对于IKEv2，可以在包含相同类型的多个算法（由-分隔） conn xauth_psk #PSK认证需要 keyexchange=ikev2\t# 使用 IKEv2 left=%defaultroute leftauth=psk\t# 服务器校验方式 leftsubnet=0.0.0.0/0 right=%any rightauth=psk rightsourceip=192.168.137.0/24 auto=add conn IKEv2-pubkey\t#RSA认证 # 服务器端根证书 DN 名称 leftca=\u0026#34;CN=ares\u0026#34; # 服务器证书，可以是 PEM 或 DER 格式 leftcert=server.cert.pem # 不指定客户端证书路径 # rightcert = \u0026lt;path\u0026gt; # 指定服务器证书的公钥 leftsigkey=server.pub.pem # rightsigkey = \u0026lt;raw public key\u0026gt; | \u0026lt;path to public key\u0026gt; # 是否发送服务器证书到客户端 leftsendcert=always # 客户端不发送证书 rightsendcert=never # 服务端认证方法，使用证书 leftauth=pubkey # 客户端认证使用 EAP 扩展认证，貌似 eap-mschapv2 比较通用 rightauth=eap-mschapv2 # 服务端 ID，可以任意指定，默认为服务器证书的 subject，还可以是魔术字 %any，表示什么都行 leftid=%any # 客户端 id，任意 rightid=%any ","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/linux/ipsec_ikev2%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2/","summary":"\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://www.cnblogs.com/aresxin/p/17864829.html\"\u003ehttps://www.cnblogs.com/aresxin/p/17864829.html\u003c/a\u003e\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch2 id=\"开启内核转发\"\u003e开启内核转发\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e8\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# tail -6 /etc/sysctl.conf \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.ip_forward=1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv6.conf.all.forwarding=1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.conf.all.accept_redirects = 0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv6.conf.all.accept_redirects = 0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# sysctl -p\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"ipsecconf配置\"\u003eipsec.conf配置\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e43\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e44\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e45\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e46\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e47\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e48\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e49\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e50\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e51\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e52\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e53\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e54\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e55\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e56\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e57\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e58\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e59\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e60\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e61\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# cat /etc/ipsec.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003econfig setup\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        charondebug=\u0026#34;ike 1, knl 1, cfg 0, net 1\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        strictcrlpolicy=no\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        uniqueids=yes  # 如果同一个用户在不同的设备上重复登录,yes 断开旧连接,创建新连接;no 保持旧连接,并发送通知; never 同 no, 但不发送通知.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        cachecrls=no \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003econn ipsec-ikev2-vpn   #XAUTH认证需要\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      auto=add\t\t\t# 当服务启动时, 应该如何处理这个连接项,add 添加到连接表中\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      compress=no\t\t# 是否启用压缩, yes 表示如果支持压缩会启用\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      type=tunnel\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      keyexchange=ikev2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      fragmentation=yes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      forceencaps=yes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      dpdaction=clear\t# 当意外断开后尝试的操作\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      dpddelay=300s\t\t# dpd时间间隔\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      rekey=no\t\t\t# 不自动重置密钥\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      left=%any\t\t\t# 服务器端标识，可以是魔术字 %any，表示从本地ip地址表中取\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      leftid=123.13.12.1\t\t# 服务器端ID标识,这里为你的公网ip，或者@你的域名\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      leftcert=server.cert.pem\t# 服务器端证书\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      leftsendcert=always\t\t# 是否发送服务器证书到客户端\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      leftsubnet=0.0.0.0/0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      right=%any\t\t# 客户端标识，%any表示任意\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      rightid=%any\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      rightauth=eap-mschapv2\t\t\t#KEv2 EAP(Username/Password)\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      rightsourceip=192.168.137.0/24 \t # 客户端IP地址分配范围\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      rightdns=223.5.5.5,223.6.6.6\t\t# DNS\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      rightsendcert=never\t\t\t\t# 客户端不发送证书\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      eap_identity=%identity\t\t\t# 指定客户端eap id\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      ike=chacha20poly1305-sha512-curve25519-prfsha512,aes256gcm16-sha384-prfsha384-ecp384,aes256-sha1-modp1024,aes128-sha1-modp1024,3des-sha1-modp1024!\t\t\t# 密钥交换协议加密算法列表，可以包括多个算法和协议。\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      esp=chacha20poly1305-sha512,aes256gcm16-ecp384,aes256-sha256,aes256-sha1,3des-sha1!\t# 数据传输协议加密算法列表,对于IKEv2，可以在包含相同类型的多个算法（由-分隔）\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003econn xauth_psk    #PSK认证需要\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      keyexchange=ikev2\t\t# 使用 IKEv2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      left=%defaultroute\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      leftauth=psk\t\t\t# 服务器校验方式\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      leftsubnet=0.0.0.0/0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      right=%any\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      rightauth=psk\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      rightsourceip=192.168.137.0/24\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      auto=add\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003econn IKEv2-pubkey\t#RSA认证\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    # 服务器端根证书 DN 名称\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    leftca=\u0026#34;CN=ares\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    # 服务器证书，可以是 PEM 或 DER 格式\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    leftcert=server.cert.pem\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    # 不指定客户端证书路径\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    # rightcert = \u0026lt;path\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    # 指定服务器证书的公钥\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    leftsigkey=server.pub.pem\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    # rightsigkey = \u0026lt;raw public key\u0026gt; | \u0026lt;path to public key\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    # 是否发送服务器证书到客户端\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    leftsendcert=always\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    # 客户端不发送证书\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    rightsendcert=never\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    # 服务端认证方法，使用证书\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    leftauth=pubkey\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    # 客户端认证使用 EAP 扩展认证，貌似 eap-mschapv2 比较通用\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    rightauth=eap-mschapv2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    # 服务端 ID，可以任意指定，默认为服务器证书的 subject，还可以是魔术字 %any，表示什么都行\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    leftid=%any\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    # 客户端 id，任意\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    rightid=%any\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"IPsec/IKEv2服务部署"},{"content":"一、虚拟机A（Ubuntu 20）配置 1. 安装WireGuard 1 2 sudo apt update sudo apt install wireguard resolvconf # 安装WireGuard和DNS工具（如需） 2. 生成服务器密钥对 1 2 3 # 生成私钥和公钥 sudo umask 077 # 确保密钥文件权限安全 sudo wg genkey | sudo tee /etc/wireguard/server_private.key | wg pubkey | sudo tee /etc/wireguard/server_public.key 3. 配置WireGuard服务端 创建配置文件 /etc/wireguard/wg0.conf：\n1 sudo nano /etc/wireguard/wg0.conf 内容如下（根据需求修改）：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 [Interface] Address = 10.10.20.1/24 # 服务器虚拟IP（WireGuard内网段） SaveConfig = true ListenPort = 51820 # 监听端口（确保防火墙开放） PrivateKey = \u0026lt;服务器私钥\u0026gt; # 从 /etc/wireguard/server_private.key 复制 PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -A FORWARD -o %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -D FORWARD -o %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE # 客户端配置（示例：允许两个客户端） [Peer] # 客户端1 PublicKey = \u0026lt;客户端1公钥\u0026gt; AllowedIPs = 10.10.20.2/32 # 分配给客户端的虚拟IP [Peer] # 客户端2 PublicKey = \u0026lt;客户端2公钥\u0026gt; AllowedIPs = 10.10.20.3/32 4. 启用IP转发和NAT 编辑 /etc/sysctl.conf：\n1 net.ipv4.ip_forward=1 加载配置：\n1 sudo sysctl -p 5. 启动WireGuard服务 1 2 sudo systemctl enable wg-quick@wg0 sudo systemctl start wg-quick@wg0 6. 开放防火墙端口 1 2 sudo ufw allow 51820/udp # 允许WireGuard端口 sudo ufw reload 二、客户端配置（以Windows和Android为例） 1. 生成客户端密钥对 在客户端机器上生成密钥（以客户端1为例）：\n1 2 3 4 # Linux/macOS/WSL： wg genkey | tee client1_private.key | wg pubkey \u0026gt; client1_public.key # Windows（需安装WireGuard客户端后，在界面中生成密钥） 2. 客户端配置文件（示例：client1.conf） 1 2 3 4 5 6 7 8 9 10 [Interface] PrivateKey = \u0026lt;客户端1私钥\u0026gt; Address = 10.10.20.2/24 # 客户端虚拟IP（需与服务端AllowedIPs一致） DNS = 8.8.8.8 # 可选DNS [Peer] PublicKey = \u0026lt;服务器公钥\u0026gt; # 从 /etc/wireguard/server_public.key 复制 Endpoint = \u0026lt;服务器公网IP\u0026gt;:51820 # 虚拟机A的ens1网卡IP AllowedIPs = 0.0.0.0/0 # 将所有流量路由到VPN（或指定子网） PersistentKeepalive = 25 # 保持连接 3. 将客户端公钥添加到服务端 在虚拟机A上编辑 /etc/wireguard/wg0.conf，添加客户端的[Peer]段：\n1 2 3 [Peer] PublicKey = \u0026lt;客户端1公钥\u0026gt; AllowedIPs = 10.10.20.2/32 重启WireGuard服务：\n1 sudo systemctl restart wg-quick@wg0 4. 客户端连接 Windows：\n安装 WireGuard客户端。 导入 client1.conf 文件。 点击“激活”连接。 Android/iOS：\n安装 WireGuard 客户端。 扫描配置文件二维码（或手动导入）。 三、验证和排错 1. 检查服务端状态 1 sudo wg show # 查看连接的对等节点和流量统计 2. 测试连通性 客户端执行： 1 2 3 ping 10.10.20.1 # 测试VPN内网连通性 ping 8.8.8.8 # 测试外网（需服务端NAT配置正确） ping \u0026lt;物理机IP\u0026gt; # 测试访问物理机 3. 常见问题 无法连接：\n检查服务端防火墙是否开放UDP 51820。 确保客户端和服务端的公钥/私钥配对正确。 检查服务端NAT规则（iptables -t nat -L）。 无网络流量：\n确认服务端已启用IP转发（sysctl net.ipv4.ip_forward）。 检查客户端AllowedIPs是否为 0.0.0.0/0（全局流量）或指定子网。 四、扩展配置（可选） 1. 动态IP客户端 在服务端配置中，允许客户端IP动态分配：\n1 2 3 4 5 [Peer] PublicKey = \u0026lt;客户端公钥\u0026gt; AllowedIPs = 10.10.20.2/32 # 固定IP # 或 AllowedIPs = 10.10.20.0/24 # 允许客户端使用整个子网 2. 多子网路由 如果客户端需要访问其他子网（如虚拟机B的网段 192.168.100.0/24）：\n1 2 3 4 5 # 在服务端添加路由 sudo ip route add 192.168.100.0/24 dev wg0 # 在客户端配置中指定AllowedIPs： AllowedIPs = 0.0.0.0/0, 192.168.100.0/24 五、安全性建议 限制客户端IP范围：避免使用 AllowedIPs = 0.0.0.0/0，按需分配。 定期更换密钥：删除旧密钥并重新生成。 启用防火墙白名单：仅允许已知IP连接服务端。 通过以上步骤，WireGuard VPN服务将部署完成，客户端可通过虚拟机A访问物理机和其他网络资源。\n","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/linux/wireguard%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2/","summary":"\u003ch3 id=\"一虚拟机aubuntu-20配置\"\u003e\u003cstrong\u003e一、虚拟机A（Ubuntu 20）配置\u003c/strong\u003e\u003c/h3\u003e\n\u003ch4 id=\"1-安装wireguard\"\u003e\u003cstrong\u003e1. 安装WireGuard\u003c/strong\u003e\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt update\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt install wireguard resolvconf  \u003cspan class=\"c1\"\u003e# 安装WireGuard和DNS工具（如需）\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch4 id=\"2-生成服务器密钥对\"\u003e\u003cstrong\u003e2. 生成服务器密钥对\u003c/strong\u003e\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 生成私钥和公钥\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo \u003cspan class=\"nb\"\u003eumask\u003c/span\u003e \u003cspan class=\"m\"\u003e077\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# 确保密钥文件权限安全\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo wg genkey \u003cspan class=\"p\"\u003e|\u003c/span\u003e sudo tee /etc/wireguard/server_private.key \u003cspan class=\"p\"\u003e|\u003c/span\u003e wg pubkey \u003cspan class=\"p\"\u003e|\u003c/span\u003e sudo tee /etc/wireguard/server_public.key\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch4 id=\"3-配置wireguard服务端\"\u003e\u003cstrong\u003e3. 配置WireGuard服务端\u003c/strong\u003e\u003c/h4\u003e\n\u003cp\u003e创建配置文件 \u003ccode\u003e/etc/wireguard/wg0.conf\u003c/code\u003e：\u003c/p\u003e","title":"WireGuard服务部署"},{"content":"一、安装Samba服务 安装软件包\n使用yum安装Samba核心组件：\n1 yum install samba samba-client samba-common -y 说明：samba为服务端程序，samba-client提供客户端工具，samba-common包含通用文件。\n启动服务并设置开机自启\n1 2 systemctl start smb nmb # 启动Samba服务 systemctl enable smb nmb # 设置开机自启 二、配置Samba共享 创建共享目录并设置权限\n1 2 3 mkdir -p /srv/shared # 创建共享目录 chmod -R 777 /srv/shared # 设置目录权限（按需调整） chown -R nobody:nobody /srv/shared # 指定所有者（匿名访问时使用） 编辑主配置文件 /etc/samba/smb.conf\n备份原文件后，添加以下内容：\n1 2 3 4 5 6 7 8 9 10 11 12 13 [global] workgroup = WORKGROUP # 工作组名（与Windows一致） security = user # 安全模式：user（需密码）或share（匿名） passdb backend = tdbsam # 用户数据库类型 map to guest = Bad User # 允许匿名访问（仅share模式需要） [shared] comment = Public Share # 共享描述 path = /srv/shared # 共享目录路径 browseable = yes # 允许浏览 writable = yes # 允许写入 public = yes # 允许匿名访问（share模式） valid users = user1, @group1 # 仅允许指定用户或组访问（user模式） 说明：选择security = user时需配置用户密码，security = share则允许匿名访问。\n配置用户验证（user模式）\n创建系统用户并设置Samba密码： 1 2 useradd user1 # 创建用户 smbpasswd -a user1 # 设置Samba密码 查看Samba用户列表： 1 pdbedit -L 三、防火墙与SELinux设置 防火墙配置\n开放SMB端口： 1 2 firewall-cmd --permanent --add-service=samba firewall-cmd --reload 或关闭防火墙（测试环境）： 1 systemctl stop firewalld \u0026amp;\u0026amp; systemctl disable firewalld 禁用SELinux\n临时关闭： 1 setenforce 0 永久关闭（编辑/etc/selinux/config）： 1 SELINUX=disabled 说明：SELinux可能阻止共享访问，建议测试时关闭。\n四、测试与访问 Windows客户端访问\n打开资源管理器，输入地址：\\\\\u0026lt;服务器IP\u0026gt;\\shared。 输入用户名和密码（user模式）或直接访问（share模式）。 Linux客户端挂载共享\n安装客户端工具： 1 yum install cifs-utils -y 挂载共享目录： 1 mount -t cifs //\u0026lt;服务器IP\u0026gt;/shared /mnt -o username=user1,password=123 五、高级配置 多用户权限控制\n在smb.conf中通过valid users和write list指定不同用户的读写权限。例如： 1 2 3 4 5 [department] path = /srv/department valid users = @group1 writable = yes write list = user1 说明：使用@group1允许组访问，write list限制仅user1可写。\n禁用旧协议（SMB1）\n编辑/etc/modprobe.d/local.conf： 1 echo \u0026#34;options cifs disable_legacy_dialects=Y\u0026#34; \u0026gt;\u0026gt; /etc/modprobe.d/local.conf 说明：提升安全性，需内核版本≥4.18。\n常见问题 无法写入文件：检查目录权限（chmod 777）及SELinux状态。 匿名访问失败：确认security = share，并设置public = yes。 端口被阻止：确保防火墙开放139/TCP、445/TCP、137-138/UDP。 通过以上步骤，您可以在CentOS系统上快速部署Samba服务，并根据需求灵活配置共享权限与安全策略。\n","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/linux/smb%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2/","summary":"\u003ch3 id=\"一安装samba服务\"\u003e\u003cstrong\u003e一、安装Samba服务\u003c/strong\u003e\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e安装软件包\u003c/strong\u003e\u003cbr\u003e\n使用yum安装Samba核心组件：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install samba samba-client samba-common -y\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cem\u003e说明：\u003ccode\u003esamba\u003c/code\u003e为服务端程序，\u003ccode\u003esamba-client\u003c/code\u003e提供客户端工具，\u003ccode\u003esamba-common\u003c/code\u003e包含通用文件。\u003c/em\u003e\u003c/p\u003e","title":"SMB服务部署"},{"content":"Linux笔记 * centos被弃用后yum无法正常使用 下载CentOS 7的repo文件\n1 2 3 wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo # 或者 curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo 更新镜像源\n1 2 3 4 # 清除缓存： yum clean all # 生成缓存： yum makecache 一： Linux基本配置 1. 配置网卡，静态 IP 1 2 3 4 5 6 7 8 9 10 11 12 13 [root@localhost ~]# vi /etc/sysconfig/network-scripts/ifcfg-ens33 #修改 BOOTPROTO=static ONBOOT=yes #增加 IPADDR=192.168.197.129 GATEWAY=192.168.197.2 NETMASK=255.255.255.0 DNS1=144.144.144.144 DNS2=1.1.1.1 [root@localhost ~]# systemctl restart network.service 2. 更新yum,安装系统工具net-tools,常用工具，依赖关系 mini 1 yum -y install net-tools vim-enhanced zip unzip curl telnet wget 个人常用 1 [root@localhost ~]# yum -y install net-tools telnet gcc gcc-c++ make autoconf wget curl curl-devel openssl openssl-devel vim-enhanced zip unzip ntpdate patch expect rsync 可选 1 2 [root@localhost ~]# yum -y update [root@localhost ~]# yum -y install net-tools telnet gcc gcc-c++ make autoconf wget lrzsz libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5-devel libidn libidn-devel openssl openssl-devel libxslt-devel libevent-devel libtool libtool-ltdl bison gd gd-devel vim-enhanced pcre-devel zip unzip ntpdate sysstat patch bc expect rsync 3. 关闭SELINUX 1 2 3 4 5 [root@localhost ~]# vim /etc/sysconfig/selinux #SELINUX=enforcing SELINUX=disabled [root@localhost ~]# setenforce 0 4. 设置时间时区 1 2 3 4 5 6 7 8 [root@localhost ~]# yum install ntp\t#安装ntp服务的软件包 [root@localhost ~]# systemctl enable ntpd\t#将ntp服务设置为缺省启动 [root@localhost ~]# vim /etc/sysconfig/ntpd\t#修改启动参数，增加-g -x参数 OPTIONS=\u0026#34;-g -x\u0026#34; [root@localhost ~]# systemctl restart ntpd\t#启动ntp服务 [root@localhost ~]# ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\t#将系统时区改为上海时间 (亦即CST时区) 5. 关闭防火墙 (可选，要安全些的话还是老老实实的在需要的时候配防火墙吧) 1 2 [root@localhost ~]# systemctl stop firewalld.service\t# 关闭 “系统防火墙” [root@localhost ~]# systemctl disable firewalld.service\t# 关闭 “系统防火墙” 自启动 6. 修改主机名 1 [root@localhost ~]# hostnamectl set-hostname master 7. 配置ssh 1 2 3 4 5 6 7 8 [root@localhost ~]# vim /etc/ssh/ssh_config StrictHostKeyChecking no\t#免输入yes进行known_hosts添加 UserKnownHostsFile /dev/null\t#可时时删除known_hosts文件免除known_hosts未更新导致的冲突 [root@localhost ~]# vim /etc/ssh/sshd_config #解决ssh链接慢问题 UseDNS no\t#UseDNS yes改为no, 如果没有或默认注释就添加UseDNS no GSSAPIAuthentication no\t#GSSAPIAuthentication yes改为no, 如果没有或默认注释就添加GSSAPIAuthentication no 8.免密登录 (可选) 1 2 ssh-keygen -t rsa cat ~/.ssh/id_rsa.pub \u0026gt;\u0026gt; ~/.ssh/authorized_keys ","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/linux/centos7%E6%9C%80%E5%B0%8F%E5%AE%89%E8%A3%85%E5%90%8E%E9%85%8D%E7%BD%AE/","summary":"\u003ch1 id=\"linux笔记\"\u003eLinux笔记\u003c/h1\u003e\n\u003ch2 id=\"-centos被弃用后yum无法正常使用\"\u003e* centos被弃用后yum无法正常使用\u003c/h2\u003e\n\u003cp\u003e下载CentOS 7的repo文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 或者\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecurl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e更新镜像源\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 清除缓存：\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum clean all\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 生成缓存：\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum makecache\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"一-linux基本配置\"\u003e一： Linux基本配置\u003c/h2\u003e\n\u003ch3 id=\"1-配置网卡静态-ip\"\u003e1. 配置网卡，静态 IP\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# vi /etc/sysconfig/network-scripts/ifcfg-ens33\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#修改\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eBOOTPROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003estatic\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eONBOOT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#增加\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eIPADDR\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e192.168.197.129\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eGATEWAY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e192.168.197.2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eNETMASK\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e255.255.255.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eDNS1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e144.144.144.144\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eDNS2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e1.1.1.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# systemctl restart network.service\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"2-更新yum安装系统工具net-tools常用工具依赖关系\"\u003e2. 更新yum,安装系统工具net-tools,常用工具，依赖关系\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003emini\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum -y install net-tools vim-enhanced zip unzip curl telnet wget\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e个人常用\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# yum -y install net-tools telnet gcc gcc-c++ make autoconf wget curl curl-devel openssl openssl-devel vim-enhanced zip unzip ntpdate patch expect rsync\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e可选\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# yum -y update\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# yum -y install net-tools telnet gcc gcc-c++ make autoconf wget lrzsz libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5-devel libidn libidn-devel openssl openssl-devel libxslt-devel libevent-devel libtool libtool-ltdl bison gd gd-devel vim-enhanced pcre-devel zip unzip ntpdate sysstat patch bc expect rsync\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"3-关闭selinux\"\u003e3. 关闭SELINUX\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# vim /etc/sysconfig/selinux\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#SELINUX=enforcing\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eSELINUX\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003edisabled\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# setenforce 0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"4-设置时间时区\"\u003e4. 设置时间时区\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e8\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# yum install ntp\t\t#安装ntp服务的软件包\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# systemctl enable ntpd\t\t#将ntp服务设置为缺省启动\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# vim /etc/sysconfig/ntpd\t\t#修改启动参数，增加-g -x参数\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eOPTIONS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;-g -x\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# systemctl restart ntpd\t\t#启动ntp服务\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\t\t#将系统时区改为上海时间 (亦即CST时区)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"5-关闭防火墙-可选要安全些的话还是老老实实的在需要的时候配防火墙吧\"\u003e5. 关闭防火墙 (可选，要安全些的话还是老老实实的在需要的时候配防火墙吧)\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# systemctl stop firewalld.service\t\t# 关闭 “系统防火墙” \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# systemctl disable firewalld.service\t\t# 关闭 “系统防火墙” 自启动\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"6-修改主机名\"\u003e6. 修改主机名\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# hostnamectl set-hostname master\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"7-配置ssh\"\u003e7. 配置ssh\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e8\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# vim /etc/ssh/ssh_config\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        StrictHostKeyChecking no\t\t\u003cspan class=\"c1\"\u003e#免输入yes进行known_hosts添加\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        UserKnownHostsFile /dev/null\t\t\u003cspan class=\"c1\"\u003e#可时时删除known_hosts文件免除known_hosts未更新导致的冲突\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e           \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# vim /etc/ssh/sshd_config\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"c1\"\u003e#解决ssh链接慢问题\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\tUseDNS no\t\t\u003cspan class=\"c1\"\u003e#UseDNS yes改为no, 如果没有或默认注释就添加UseDNS no\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\tGSSAPIAuthentication no\t\t\u003cspan class=\"c1\"\u003e#GSSAPIAuthentication yes改为no, 如果没有或默认注释就添加GSSAPIAuthentication no\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"8免密登录-可选\"\u003e8.免密登录 (可选)\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003essh-keygen -t rsa\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat ~/.ssh/id_rsa.pub \u0026gt;\u0026gt; ~/.ssh/authorized_keys\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"CentOS7最小安装后配置"},{"content":"直接安装 比如：devtoolset-8-gcc-g++ , 或其他版本\n然后通过 如下命令启用并进入对应版本环境：\n1 2 3 scl enable devtoolset-8 bash #或 source /opt/rh/devtoolset-8/enable 如需直接替换：\n1 2 ln -s /opt/rh/devtoolset-8/root/bin/gcc /usr/bin/gcc #其他类似 ","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/linux/centos7%E4%BD%BF%E7%94%A8%E9%AB%98%E7%89%88%E6%9C%ACgcc/","summary":"\u003cp\u003e直接安装 比如：devtoolset-8-gcc-g++ , 或其他版本\u003c/p\u003e\n\u003cp\u003e然后通过 如下命令启用并进入对应版本环境：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003escl \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e devtoolset-8 bash\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#或\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003esource\u003c/span\u003e /opt/rh/devtoolset-8/enable\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e如需直接替换：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eln -s /opt/rh/devtoolset-8/root/bin/gcc /usr/bin/gcc\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#其他类似\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"CentOS7 使用高版本gcc"},{"content":"1. fmemopen（Linux POSIX 标准） 功能：将内存缓冲区伪装成文件流（FILE*），支持标准文件 I/O 操作（如 fprintf、fscanf） 核心机制： 参数：buf（预分配内存指针）、size（缓冲区大小）、mode（读写模式，如 \u0026ldquo;r+\u0026quot;）。 若 buf=NULL，则自动分配动态内存（需手动释放）。 应用场景： 避免磁盘 I/O：处理内存中的数据（如解析网络报文）。 兼容文件 API：第三方库仅支持 FILE* 参数时，将内存数据转为文件流。 代码示例： 1 2 3 4 5 ```c char buffer[64]; FILE *stream = fmemopen(buffer, sizeof(buffer), \u0026#34;w+\u0026#34;); fprintf(stream, \u0026#34;Hello, world!\u0026#34;); fclose(stream); // 关闭时自动添加终止符（若空间允许） 2. MemoryModule（Windows 第三方库） 功能：直接从内存加载 DLL（无需落盘），返回模块句柄供调用。 核心机制： 解析内存中的 PE 文件格式，模拟系统加载器行为（重定位、导入表修复）。 支持通过 MemoryGetProcAddress 获取函数指针。 应用场景： 加密 DLL 运行时解密：避免恶意软件扫描磁盘文件。 网络分发插件：远程下载 DLL 后直接内存加载。 对比与限制 特性 fmemopen (Linux) MemoryModule (Windows) 标准性 POSIX 标准（非全平台支持） 第三方库（非系统原生） 内存管理 需预分配缓冲区或动态分配 自动处理内存分配与重定位 安全性 缓冲区溢出风险 需自行校验内存来源合法性 ","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/system_level/%E5%86%85%E5%AD%98%E7%BC%93%E5%86%B2%E5%8C%BA%E4%BC%AA%E8%A3%85%E6%96%87%E4%BB%B6%E6%B5%81/","summary":"\u003ch2 id=\"1-fmemopenlinux-posix-标准\"\u003e1. fmemopen（Linux POSIX 标准）\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e功能\u003c/strong\u003e：将内存缓冲区伪装成文件流（FILE*），支持标准文件 I/O 操作（如 fprintf、fscanf）\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e核心机制\u003c/strong\u003e：\n\u003cul\u003e\n\u003cli\u003e参数：buf（预分配内存指针）、size（缓冲区大小）、mode（读写模式，如 \u0026ldquo;r+\u0026quot;）。\u003c/li\u003e\n\u003cli\u003e若 buf=NULL，则自动分配动态内存（需手动释放）。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e应用场景\u003c/strong\u003e：\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e避免磁盘 I/O\u003c/strong\u003e：处理内存中的数据（如解析网络报文）。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e兼容文件 API\u003c/strong\u003e：第三方库仅支持 FILE* 参数时，将内存数据转为文件流。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e代码示例\u003c/strong\u003e：\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e```c\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echar buffer[64];\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eFILE *stream = fmemopen(buffer, sizeof(buffer), \u0026#34;w+\u0026#34;);\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003efprintf(stream, \u0026#34;Hello, world!\u0026#34;);\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003efclose(stream);  // 关闭时自动添加终止符（若空间允许）\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-memorymodulewindows-第三方库\"\u003e2. MemoryModule（Windows 第三方库）\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e功能\u003c/strong\u003e：直接从内存加载 DLL（无需落盘），返回模块句柄供调用。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e核心机制\u003c/strong\u003e：\n\u003cul\u003e\n\u003cli\u003e解析内存中的 PE 文件格式，模拟系统加载器行为（重定位、导入表修复）。\u003c/li\u003e\n\u003cli\u003e支持通过 MemoryGetProcAddress 获取函数指针。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e应用场景\u003c/strong\u003e：\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e加密 DLL 运行时解密\u003c/strong\u003e：避免恶意软件扫描磁盘文件。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e网络分发插件\u003c/strong\u003e：远程下载 DLL 后直接内存加载。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"对比与限制\"\u003e对比与限制\u003c/h2\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003e特性\u003c/th\u003e\n          \u003cth\u003efmemopen (Linux)\u003c/th\u003e\n          \u003cth\u003eMemoryModule (Windows)\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003e标准性\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003ePOSIX 标准（非全平台支持）\u003c/td\u003e\n          \u003ctd\u003e第三方库（非系统原生）\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003e内存管理\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003e需预分配缓冲区或动态分配\u003c/td\u003e\n          \u003ctd\u003e自动处理内存分配与重定位\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003e安全性\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003e缓冲区溢出风险\u003c/td\u003e\n          \u003ctd\u003e需自行校验内存来源合法性\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e","title":"如何将内存缓冲区伪装成文件流"},{"content":" 由于 CentOS7 为glibc 2.17，故而无法安装高版本\n但可以获取非官方编译包\n1 2 3 4 5 # 下载并解压非官方编译包（示例） wget https://unofficial-builds.nodejs.org/download/release/v22.16.0/node-v22.16.0-linux-x64-glibc-217.tar.gz tar -xzf node-v22.16.0-linux-x64-glibc-217.tar.gz -C /usr/local/ ln -s /usr/local/node-v22.16.0-linux-x64/bin/node /usr/bin/node ln -s /usr/local/node-v22.16.0-linux-x64/bin/npm /usr/bin/npm ","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/linux/centos7_nodejs%E5%AE%89%E8%A3%85/","summary":"\u003cblockquote\u003e\n\u003cp\u003e由于 CentOS7 为glibc 2.17，故而无法安装高版本\u003c/p\u003e\n\u003cp\u003e但可以获取非官方编译包\u003c/p\u003e\u003c/blockquote\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 下载并解压非官方编译包（示例）\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://unofficial-builds.nodejs.org/download/release/v22.16.0/node-v22.16.0-linux-x64-glibc-217.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar -xzf node-v22.16.0-linux-x64-glibc-217.tar.gz -C /usr/local/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eln -s /usr/local/node-v22.16.0-linux-x64/bin/node /usr/bin/node\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eln -s /usr/local/node-v22.16.0-linux-x64/bin/npm /usr/bin/npm\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"CentOS7 上安装 NodeJs"},{"content":"","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/network/vpn/ipsec/strongswan%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/","summary":"","title":"StrongSwan安装部署（CentOS7 为例）"},{"content":"什么是IPSec\nIPSec（Internet Protocol Security）是IETF（Internet Engineering Task Force）制定的一组开放的网络安全协议。它并不是一个单独的协议，而是一系列为IP网络提供安全性的协议和服务的集合。\nIPSec用来解决IP层安全性问题的技术。IPSec被设计为同时支持IPv4和IPv6网络。主要通过加密与验证等方式，为IP数据包提供安全服务。\nIPSec提供的服务?\n数据来源验证：接收方验证发送方身份是否合法。\n数据加密：发送方对数据进行加密，以密文的形式在Internet上传送，接收方对接收的加密数据进行解密后处理或直接转发。\n数据完整性：接收方对接收的数据进行验证，以判定报文是否被篡改。\n抗重放：接收方拒绝旧的或重复的数据包，防止恶意用户通过重复发送捕获到的数据包所进行的攻击。\nIPSec VPN的应用场景分为3种：\nSite-to-Site（站点到站点或者网关到网关）：如弯曲评论的3个机构分布在互联网的3个不同的地方，各使用一个商务领航网关相互建立VPN隧道，企业内网（若干PC）之间的数据通过这些网关建立的IPSec隧道实现安全互联。\nEnd-to-End（端到端或者PC到PC）： 两个PC之间的通信由两个PC之间的IPSec会话保护，而不是网关。\nEnd-to-Site（端到站点或者PC到网关）：两个PC之间的通信由网关和异地PC之间的IPSec进行保护。\nVPN只是IPSec的一种应用方式:\nIPSec其实是IP Security的简称，它的目的是为IP提供高安全性特性，VPN则是在实现这种安全特性的方式下产生的解决方案。IPSec是一个框架性架构，具体由两类协议组成：\nAH协议（Authentication Header，使用较少）：可以同时提供数据完整性确认、数据来源确认、防重放等安全特性；AH常用摘要算法（单向Hash函数）MD5和SHA1实现该特性。\nESP协议（Encapsulated Security Payload，使用较广）：可以同时提供数据完整性确认、数据加密、防重放等安全特性；ESP通常使用DES、3DES、AES等加密算法实现数据加密，使用MD5或SHA1来实现数据完整性。\nIPSec封装模式:\n可以发现传输模式和隧道模式的区别：\n传输模式在AH、ESP处理前后IP头部保持不变，主要用于End-to-End的应用场景。\n隧道模式则在AH、ESP处理之后再封装了一个外网IP头，主要用于Site-to-Site的应用场景。\n总的来说就是：\n隧道模式：加密整个 IP 数据包，通常用于站点到站点 VPN，因为需要在两个不同的网络之间建立一个完全加密的通道。该模式封装并加密整个 IP 包，然后附加一个新的外部 IP 头部进行传输。\n传输模式：仅加密 IP 数据包的负载部分（即实际数据），保留原始的 IP 头部。通常用于主机到主机或客户端到服务器的连接，适用于远程访问 VPN。\nIPSec除了一些协议原理外，我们更关注的是协议中涉及到方案制定的内容：\n兴趣流：IPSec是需要消耗资源的保护措施，并非所有流量都需要IPSec进行处理，而需要IPSec进行保护的流量就称为兴趣流，最后协商出来的兴趣流是由发起方和响应方所指定兴趣流的交集，如发起方指定兴趣流为192.168.1.0/24 -\u0026gt; 10.0.0.0/8，而响应方的兴趣流为10.0.0.0/8 -\u0026gt; 192.168.0.0/16，那么其协商结果是192.168.1.0/24 \u0026lt;-\u0026gt; 10.0.0.0/8，这就是最后会被IPSec所保护的兴趣流。\n发起方：Initiator，IPSec会话协商的触发方，IPSec会话通常是由指定兴趣流触发协商，触发的过程通常是将数据包中的源、目的地址、协议以及源、目的端口号与提前指定的IPSec兴趣流匹配模板如ACL进行匹配，如果匹配成功则属于指定兴趣流。指定兴趣流只是用于触发协商，至于是否会被IPSec保护要看是否匹配协商兴趣流，但是在通常实施方案过程中，通常会设计成发起方指定兴趣流属于协商兴趣流。\n响应方：Responder，IPSec会话协商的接收方，响应方是被动协商，响应方可以指定兴趣流，也可以不指定（完全由发起方指定）。\n发起方和响应方协商的内容主要包括：双方身份的确认和密钥种子刷新周期、AH/ESP的组合方式及各自使用的算法，还包括兴趣流、封装模式等。\nSA：发起方、响应方协商的结果就是曝光率很高的SA，SA通常是包括密钥及密钥生存期、算法、封装模式、发起方、响应方地址、兴趣流等内容。 **上图描述了由兴趣流触发的IPSec协商流程，**原生IPSec并无身份确认等协商过程，在方案上存在诸多缺陷，如无法支持发起方地址动态变化情况下的身份确认、密钥动态更新等。伴随IPSec出现的IKE（Internet Key Exchange）协议专门用来弥补这些不足：\n发起方定义的兴趣流是源192.168.1.0/24目的10.0.0.0/8，所以在接口发送发起方内网PC发给响应方内网PC的数据包，能够得以匹配。\n满足兴趣流条件，在转发接口上检查SA不存在、过期或不可用，都会进行协商，否则使用当前SA对数据包进行处理。\n协商的过程通常分为两个阶段，第一阶段是为第二阶段服务，第二阶段是真正的为兴趣流服务的SA，两个阶段协商的侧重有所不同，第一阶段主要确认双方身份的正确性，第二阶段则是为兴趣流创建一个指定的安全套件，其最显著的结果就是第二阶段中的兴趣流在会话中是密文。\nIPSec中安全性还体现在第二阶段SA永远是单向的：\n从上图可以发现，在协商第二阶段SA时，SA是分方向性的，发起方到响应方所用SA和响应放到发起方SA是单独协商的，这样做的好处在于即使某个方向的SA被破解并不会波及到另一个方向的SA。这种设计类似于双向车道设计。\nIPSec虽然只是5个字母的排列组合，但其所涉及的协议功能众多、方案又极其灵活，本期主要介绍IPSec的基本原理，在后续专栏还会继续介绍IPSec的其它方面知识\n","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/network/vpn/ipsec/ipsec%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86/","summary":"\u003cp\u003e\u003cstrong\u003e什么是IPSec\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eIPSec（Internet Protocol Security）是IETF（Internet Engineering Task Force）制定的一组开放的\u003ca href=\"https://cloud.tencent.com/product/ns?from_column=20065\u0026amp;from=20065\"\u003e网络安全\u003c/a\u003e协议。它并不是一个单独的协议，而是一系列为IP网络提供安全性的协议和服务的集合。\u003c/p\u003e\n\u003cp\u003eIPSec用来解决IP层安全性问题的技术。IPSec被设计为同时支持IPv4和IPv6网络。主要通过加密与验证等方式，为IP数据包提供安全服务。\u003c/p\u003e","title":"IPsec技术原理"},{"content":"foreach需注意的细节 1 2 3 4 5 6 7 let arr = [1,2,3,4]; for i in arr { // ... } for i in \u0026amp;arr { // ... } 前者底层会调用into_iter(self) 会导致数组复制，可能产生意料之外的损耗 let 模式匹配获取值，解决 if let 会导致新增嵌套层的问题 1 2 3 4 5 6 7 8 let Data::Struct(s) = ast.data else{ panic!(\u0026#34;MyDefault derive macro must use in struct\u0026#34;); }; let Some(s) = data else { panic!(\u0026#34;not data\u0026#34;); } println!(\u0026#34;{s}\u0026#34;); 断点调试时 LLDB和GDB看汇编源码 disassemble 命令\n1 2 3 4 (lldb) disassemble # 指定一个特定的地址或函数来查看 (lldb) disassemble -f \u0026lt;函数名\u0026gt; (lldb) disassemble \u0026lt;地址\u0026gt; Clion、RustCover 打开返汇编视图 延长生命周期 Box::leak 变形记(Transmutes) 参考：Rust - 进阶 - 类型转换 - 变形记(Transmutes) #[derive(PartialEq)] 编译器默认实现类似以下代码:\n1 2 3 4 5 6 7 impl PartialEq for Person { fn eq(\u0026amp;self, other: \u0026amp;Self) -\u0026gt; bool { self.id == other.id \u0026amp;\u0026amp; self.name == other.name \u0026amp;\u0026amp; self.height == other.height } } ","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/rust/%E8%AE%B0%E5%BD%95%E7%82%B9/","summary":"\u003ch2 id=\"foreach需注意的细节\"\u003eforeach需注意的细节\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-rust\" data-lang=\"rust\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003earr\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ein\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003earr\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\t\u003c/span\u003e\u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ein\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003earr\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\t\u003c/span\u003e\u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e前者底层会调用into_iter(self) 会导致数组复制，可能产生意料之外的损耗\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"let-模式匹配获取值解决-if-let-会导致新增嵌套层的问题\"\u003elet 模式匹配获取值，解决 if let 会导致新增嵌套层的问题\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e8\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-rust\" data-lang=\"rust\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e::\u003cspan class=\"n\"\u003eStruct\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003east\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"fm\"\u003epanic!\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;MyDefault derive macro must use in struct\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nb\"\u003eSome\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"fm\"\u003epanic!\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;not data\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"fm\"\u003eprintln!\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e{s}\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"断点调试时\"\u003e断点调试时\u003c/h2\u003e\n\u003ch3 id=\"lldb和gdb看汇编源码\"\u003eLLDB和GDB看汇编源码\u003c/h3\u003e\n\u003cp\u003edisassemble 命令\u003c/p\u003e","title":"Rust杂项记录点"},{"content":"以下是为您制定的完整系统能力提升方案，整合了源码精读、实践策略和工具链支持，特别针对Rust/Golang存储与高性能系统领域，分为三个阶段实施（附时间规划与难度标签）：\n初始方案 一、筑基阶段：存储引擎核心实现（1-2个月） 目标：掌握单机存储引擎设计范式，理解磁盘/内存交互原理\n推荐项目：\nRosedb（Golang）\n核心模块： merge.go：学习LSM Tree的Compaction策略与文件合并逻辑（重点分析数据冷热分离策略） batch.go：批处理操作的原子性实现（观察如何通过WAL保证崩溃一致性） iterator.go：跳表索引实现（对比Redis ZSET的ziplist优化思路） 实操任务： 添加TTL过期机制（需修改record.go的数据结构，增加时间戳字段） 编写Merge过程的性能压测（记录合并前后磁盘空间/IOPS变化） BoltDB（Golang）\n对比学习： 对比Rosedb的LSM与BoltDB的B+树写入路径差异（随机写vs顺序追加） 分析bolt/tx.go中MVCC实现（事务隔离性与COW机制） 产出：实现简化版LSM引擎（支持Put/Get/Scan），输出架构设计图与性能对比报告\n二、专项突破阶段：分布式系统核心机制（2-3个月） 目标：掌握分布式共识、网络通信、事务处理三大核心能力\n推荐项目：\nEtcd（Golang）\n精读路线： Raft共识：etcd/raft/raft.go的Step()状态机（重点跟踪Leader选举日志同步流程） 存储层：etcd/mvcc模块的版本控制（学习如何用Revision实现乐观锁） 网络层：etcd/clientv3的gRPC流控机制（分析错误重试算法） 实操任务： 修改lease.go实现租约自动续期（需整合心跳检测逻辑） 通过etcdctl debug模式追踪Put请求的全链路 TiKV（Rust）\n对比学习： 对比Etcd与TiKV的Raft实现差异（Multi-Raft分片 vs 单Raft组） 分析src/storage/txn/scheduler.rs的悲观锁实现（与Etcd乐观锁对比） 产出：设计分布式事务方案（支持2PC+超时回滚），输出RAFT调优手册\n三、系统实战阶段：高性能系统工程（持续迭代） 目标：构建生产级系统能力，参与开源社区\n推荐项目：\nCockroachDB（Golang）\n核心模块： pkg/sql/execution：向量化查询引擎（学习SIMD优化技巧） pkg/kv/kvserver：分布式事务的跨分片处理 参与方式： 从good first issue入手（如修复文档或补充单元测试） 优化SQL解析器性能（使用pprof定位热点） Tantivy（Rust）\n高阶实践： 修改tantivy/segment的倒排索引合并策略（引入分层合并） 为BM25算法添加自定义权重因子 产出：向开源项目提交PR，撰写技术文章解析系统设计难点\n四、效率增强工具链 工具类型 推荐工具 应用场景 源码分析 Sourcegraph 跨仓库代码搜索（跟踪函数调用链） 调试追踪 Delve（Golang） 跟踪Etcd的RAFT状态变迁（设置条件断点监控选举超时） 架构可视化 Diagrams.net 绘制Rosedb的LSM合并流程图 性能剖析 pprof + flamegraph 分析TiKV查询延迟（定位锁竞争热点） 学习管理 Obsidian知识图谱 链接核心模块笔记（如RAFT算法与ETCD实现的双向关联） 五、关键执行策略 垂直精读法：\n每周聚焦1个核心模块（如Rosedb的merge.go），输出模块流程图+关键数据结构注解 对比阅读（如Etcd的MVCC vs TiKV的Percolator模型） 问题驱动调试：\n构造极端场景（如Rosedb写入骤增触发Compaction），用Delve观察协程调度阻塞点 贡献闭环：\n1 2 3 4 5 6 graph LR A[阅读源码] --\u0026gt; B{发现优化点} B --\u0026gt;|性能| C[编写Benchmark] B --\u0026gt;|功能| D[补充测试用例] C --\u0026gt; E[提交PR+性能报告] D --\u0026gt; E 💡 避坑指南：\n避免过早陷入底层（如Rust的unsafe代码），先理解设计再啃实现细节 分布式项目从单机调试启动（Etcd需配置etcd --debug模式） 定期用pprof对比优化前后指标（如LSM合并后磁盘IO下降比例） 建议按Rosedb → Etcd → TiKV的路线递进，每周投入10-12小时，6个月可系统掌握分布式存储系统实现精髓。每阶段产出物（代码/文档/架构图）务必归档到GitHub仓库，形成可回溯的技术资产。\n补充点： 基于您对系统设计能力的深度追求，结合分布式系统设计模式的学习目标，以下是对现有知识体系的全面评估及补充方案。您已掌握的核心模式已覆盖分布式系统设计的基础架构层，但若要独立设计任意复杂系统，还需补充架构原则层、故障域深层模式和工程实践层的能力。具体分析如下：\n一、已覆盖的核心模式与能力评估 1. 基础架构设计模式（您的当前阶段） 数据分布模式：分片（Sharding）、一致性哈希（Consistent Hashing）、读写分离（CQRS） 容错模式：断路器（Circuit Breaker）、领导者选举（Leader Election）、租约（Lease）、预写日志（WAL） 通信模式：发布订阅（Pub/Sub）、边车代理（Sidecar）、事件溯源（Event Sourcing） 数据一致性模式：Quorum机制、高水位线（High-Water Mark）、读取修复（Read Repair） ✅ 能力评估：您已具备模块级设计能力，可针对特定问题（如数据分片、服务熔断）选择合适模式实现组件。\n2. 分布式理论支撑 CAP定理、PACELC定理的权衡策略 共识算法（Raft/Paxos）的工程实现 最终一致性、因果一致性的适用场景 ✅ 能力评估：可基于业务需求（如金融系统选CP，社交平台选AP）设计一致性模型。\n二、关键遗漏与进阶能力补充 1. 架构原则层：系统全局设计的哲学 原则 作用 案例 抽象渗漏法则 识别底层技术对上层设计的隐性影响（如TCP重传导致超时） 数据库连接池需感知网络分区，自动切换至本地缓存 不变性约束 定义系统不可违反的核心规则（如资金交易幂等性） 支付系统通过事务ID+去重表保证跨服务幂等 熵增对抗设计 预防系统随时间推移的架构腐化 微服务通过契约测试保障接口兼容性 2. 故障域深层模式 脑裂防护： 动态脑裂检测：通过Phi累计故障检测器（Cassandra采用）替代传统心跳，基于历史延迟方差计算故障概率 仲裁升级：结合世代时钟（Generation Clock），使新旧领导者 epoch 号严格递增（如Kafka的Controller Epoch） 灾难恢复： 混沌种子（Chaos Seeds）：在测试环境注入网络分区、时钟偏移故障，验证恢复流程 跨区域冷热备：基于Merkle树快速定位副本差异（Dynamo的反熵机制） 3. 性能与资源治理 1 2 3 4 5 6 7 graph LR A[请求入口] --\u0026gt; B{负载均衡策略} B --\u0026gt;|低延迟| C[P2P 一致性哈希] B --\u0026gt;|高吞吐| D[加权轮询+动态反馈] C --\u0026gt; E[客户端本地路由表] D --\u0026gt; F[服务端健康检查] F --\u0026gt; G[基于Phi检测器的权重调整] 动态负载需整合实时指标（如Envoy的xDS API接收服务端推送的负载状态）\n4. 可观测性深度实践 指标（Metrics）： 黄金指标：延迟、流量、错误、饱和度（RED方法） 自定义指标：如分片压缩队列深度（预警存储瓶颈） 链路追踪（Tracing）： 关键路径标记：在WAL日志中嵌入因果ID（如Google Dapper的SpanID） 三、能力培养路线图（6个月进阶计划） 阶段1：模式深化（1-2个月） 目标：掌握遗漏的架构原则与故障模式 实践： 在TiKV中实现自定义Phi检测器（替换原有心跳） 为Rosedb添加Merkle树校验层，实现快速数据同步 阶段2：全链路设计（3-4个月） 场景：设计一个跨区域部署的评论系统 要求： 读写分离：写操作强一致（CP），读操作最终一致（AP） 容灾：单区域故障时10秒内切换 关键技术点： 1 2 3 4 5 6 7 8 9 10 11 // 使用多级一致性模型 type ConsistencyLevel int const ( Strong ConsistencyLevel = iota // CP写操作 Eventual // AP读操作 ) // 区域切换器 func (s *RegionSwitcher) Failover() { s.lease.Invalidate() // 使旧区域租约失效 s.leaderElection.Run() // 触发新领导者选举 } 阶段3：工业化交付（5-6个月） 标准化交付物： 交付物 检查标准 混沌测试报告 验证99.95%的故障场景可自动恢复 分层容量规划表 分片扩容触发阈值、流量增长预测模型 SLO/SLI定义文档 明确延迟要求（如P99\u0026lt;200ms） 四、推荐学习资源 经典著作： 《Designing Data-Intensive Applications》（Martin Kleppmann） - 系统设计圣经 《Site Reliability Engineering》 - Google的SRE实践指南 开源项目深度参： CockroachDB多区域部署源码：学习跨地域数据同步（pkg/server/decommission.go） Envoy动态负载均衡：分析xDS协议实现（source/common/config/grpc_mux_impl.cc） 💡 终极能力标志：当您能预见二级故障（如时钟同步异常导致租约失效）并设计防护层时，即具备任意系统设计能力。建议每完成一个项目，用https://cognitect.com/blog/2011/11/15/documenting-architecture-decisions固化设计逻辑，逐步构建自己的模式库。\n补充方案 基于您对系统设计能力的深度追求，结合已构建的知识框架，以下是对开源项目学习库的针对性补充及最终能力地图的完善方案。您当前的知识体系已覆盖架构核心模式层（如数据分片、容错机制），但需通过以下项目填补工业级实现层与抗脆弱设计层的实践空白：\n一、开源项目深度补充（聚焦故障治理与熵增对抗） 1. 混沌工程与故障注入 Chaos Mesh（Rust） 学习重点： pkg/chaistd/io_fault.go：模拟磁盘I/O延迟的eBPF钩子实现 pkg/controller/networkchaos/reconciler.go：网络分区的TC流量控制策略 关联能力：实现“混沌种子”自动注入 实操任务：在TiKV集群中注入节点宕机故障，观察Raft组自愈过程 2. 动态负载与资源治理 Envoy（C++14，但架构极富启发性） 精读模块： source/common/upstream/load_balancer_impl.cc： 1 2 3 4 // 动态负载算法（含Phi检测器反馈机制） if (host-\u0026gt;outlierDetector().successRate() \u0026lt; threshold) { weight = 0; // 自动剔除异常节点 } source/extensions/transport_sockets/tls/ssl_socket.cc：TLS握手优化（零拷贝证书加载） 关联能力：实现基于实时指标的动态负载 3. 熵增对抗与架构防腐 Backstage（TypeScript） 学习重点： plugins/catalog-backend/src/ingestion/processors.ts： 契约测试：API版本变更时的兼容性校验 依赖拓扑分析：可视化服务耦合度（预防腐化） 工业实践：结合ADR文档实现架构约束自动化 二、能力地图最终校验（新增两大维度） （一）数据编排层（原方案缺失） 能力 学习项目 关键源码 目标 跨域数据流水线 Apache SeaTunnel connector-spark/src/main/scala/... 学习CDC变更捕获与缓冲策略 流批一体治理 Flink runtime/src/main/java/org/apache/flink/... 分析Watermark对齐与状态回溯机制 （二）成本治理层（工业系统核心） Kubernetes Vertical Pod Autoscaler（Go） 学习模块： pkg/recommender/logic.go： 1 2 3 4 5 func CalculateResources(usage history) (request, limit) { // 基于分位数预测资源需求（避免过度配置） request = Percentile(usage, 0.95) limit = Percentile(usage, 0.99) * 1.2 } 能力补全：将容量规划从“经验预估”升级为数据驱动决策 三、终极能力验证标准 当您能独立完成以下项目时，标志着具备任意系统设计能力：\n项目：多区域评论系统（抗灾难设计） 要求： 读写分离：写区域强一致（CP），读区域最终一致（AP） 容灾：单区域故障时5秒内切换（含数据一致性补偿） 关键技术实现： 1 2 3 4 5 6 7 8 9 10 11 12 13 // 1. 动态脑裂防护（采用Generation Clock） type RegionSwitcher struct { epoch int64 // 世代号严格递增 } // 2. 跨域数据补偿 func (s *SyncService) Repair() { // 基于Merkle树快速定位差异 diff := merkle.Compare(regionA, regionB) for _, hash := range diff { s.replicate(hash) // 增量修复 } } 交付物标准： 项目阶段 交付物 工业级要求 设计阶段 ADR决策文档 包含时钟偏移应对策略等5个ADR 混沌测试阶段 故障恢复SLA报告 99.95%的二级故障（如时钟异常）可自愈 上线阶段 分层容量规划表 包含流量拐点检测模型及扩容公式 四、可持续学习引擎 ADR知识库构建： 使用NebulaBootstrap的ADR模板（Markdown + 版本追踪） 示例： 1 2 3 4 5 6 7 8 # 7. 采用Merkle树实现跨域数据校验 ## 背景 跨区域数据同步需快速定位差异，避免全量对比 ## 决策 在每个分片构建Merkle树，根哈希按区域聚合 ## 后果 ✅ 差异定位从O(n)降至O(log n) ⚠️ 需额外存储哈希树（约5%空间开销） 源码深度分析工具链： Sourcegraph：追踪Envoy中load_balancer_impl的调用链 Pixie：无侵入观测K8s VPA的资源预测流程 🔥 最终建议：从Chaos Mesh + TiKV故障注入实验起步，同步撰写ADR文档固化设计决策。当您能主动预见如“NTP偏移导致租约失效”等三级故障时，即标志能力体系完整。\n最终方案 以下是为您制定的分布式系统能力全景提升方案，融合架构设计模式、故障容错、性能工程及跨域数据同步等关键领域，结合多语言顶级开源项目，形成可落地的进阶路径。方案分为四个能力维度，每个维度配套学习项目及实践任务，最终以多区域评论系统为综合验证场景。\n一、基础架构层（2-3个月） 目标：掌握分布式系统核心模式与工业级实现\n关键能力：数据分片、容错机制、通信协议\n推荐项目与学习重点：\nEnvoy（C++） - 网络代理标杆 学习重点：动态负载均衡（load_balancer_impl.cc中Phi检测器实现）、TLS握手优化（零拷贝证书加载） 实践：修改负载均衡算法，添加基于实时延迟的动态权重调整 etcd（Go） - 分布式共识范本 学习重点：Raft状态机（raft/raft.go的Step()选举逻辑）、MVCC版本控制（mvcc模块的Revision机制） 实践：实现租约自动续期与脑裂防护（注入NTP偏移故障测试） CockroachDB（Go） - 分布式SQL引擎 学习重点：分布式事务（txn_coord_sender.go的2PC实现）、向量化查询（SIMD优化技巧） 实践：为跨分片查询添加局部索引加速 二、架构原则层（1-2个月） 目标：构建系统级设计思维与抗腐化能力\n关键能力：抽象渗漏控制、不变性约束、熵增对抗\n推荐项目与学习重点：\nBackstage（TypeScript） - 架构防腐标杆 学习重点：契约测试（processors.ts的API兼容性校验）、依赖拓扑可视化 实践：为评论系统设计接口契约测试，自动检测版本断裂 Cadence（Go） - 工作流引擎 学习重点：幂等性保障（workflow/executor.go的去重逻辑）、SAGA事务补偿 实践：实现支付评论积分的SAGA事务，支持中途失败回滚 三、故障域深层（2-3个月） 目标：掌握容错模式与灾难恢复\n关键能力：脑裂防护、混沌工程、跨域同步\n推荐项目与学习重点：\nChaos Mesh（Rust） - 混沌工程平台 学习重点：eBPF故障注入（io_fault.go的磁盘延迟模拟）、网络分区控制（TC流量策略） 实践：对TiKV集群注入节点宕机故障，验证Raft组自愈 TiKV（Rust） - 分布式KV存储 学习重点：悲观锁冲突检测（txn/scheduler.rs）、Merkle树反熵（快速数据差异定位） 实践：实现跨区域数据同步的增量修复（基于Merkle树比对） Apache SeaTunnel（Java） - 跨域数据流水线 学习重点：CDC变更捕获（connector-spark的日志扫描）、流批一体治理 实践：构建评论数据跨域同步通道，支持动态通道切换 四、工程实践层（持续迭代） 目标：工业级交付与成本治理\n关键能力：SLO管理、容量规划、性能调优\n推荐项目与学习重点：\nKubernetes VPA（Go） - 资源治理 学习重点：分位数预测（pkg/recommender/logic.go的95/99线计算） 实践：为评论服务设计容量公式（QPS→CPU/内存关联模型） Flink（Java） - 流式计算 学习重点：Watermark对齐（runtime的时间窗口策略）、状态回溯 实践：实现评论热度实时计算（时间衰减模型+动态阈值） 五、综合验证：多区域评论系统 架构要求：\n读写分离：写区域CP模型（Go/CockroachDB），读区域AP模型（Java/Flink流计算） 容灾设计：5秒内区域切换（动态脑裂防护+增量修复） 数据同步：跨域CDC管道（SeaTunnel日志扫描→Merkle树校验） 关键技术实现：\n1 2 3 4 5 6 7 8 9 10 11 12 // 动态脑裂防护（Go实现） type RegionSwitcher struct { epoch int64 // 严格递增的世代号 quorum *consensus.Quorum // 基于Phi检测器的动态仲裁 } func (s *RegionSwitcher) Failover() { if s.quorum.IsSplitBrain() { // 检测脑裂 s.epoch++ // 世代号升级使旧领导者失效 s.triggerElection() } } 工业级交付物：\n阶段 交付物 标准 设计阶段 ADR决策文档 包含时钟偏移应对等5个关键决策 混沌测试阶段 故障恢复SLA报告 99.95%的二级故障可自愈 上线阶段 分层容量规划表 含流量拐点检测模型及扩容公式 六、可持续学习引擎 ADR知识库构建 使用NebulaBootstrap模板，关联决策与源码（如Envoy负载均衡策略←→容量规划公式） 源码分析工具链 Sourcegraph：追踪Envoy中load_balancer_impl的调用链路 Pixie：无侵入观测K8s VPA资源预测流程 模式反哺机制 1 2 3 4 graph LR 源码精读 --\u0026gt; 模式提取 模式提取 --\u0026gt; 反哺设计 反哺设计 --\u0026gt; 开源贡献 🔥 终极建议：从Chaos Mesh+TiKV故障实验入门，同步撰写ADR文档。当您能主动预见如“NTP偏移导致租约失效”等三级故障时，即标志能力闭环。推荐首期组合：Envoy（网络层）→ etcd（一致性）→ SeaTunnel（跨域同步），6个月内可构建完整能力体系。\n","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/plan/%E6%BA%90%E7%A0%81%E7%A0%94%E7%A9%B6%E8%AE%A1%E5%88%92/","summary":"\u003cp\u003e以下是为您制定的完整系统能力提升方案，整合了源码精读、实践策略和工具链支持，特别针对Rust/Golang存储与高性能系统领域，分为三个阶段实施（附时间规划与难度标签）：\u003c/p\u003e","title":"源码研究计划（源于AI推荐）"},{"content":" Rustup 镜像， 修改配置 ~/.zshrc or ~/.bashrc，windows直接配置环境变量 1 2 export RUSTUP_DIST_SERVER=\u0026#34;https://rsproxy.cn\u0026#34; export RUSTUP_UPDATE_ROOT=\u0026#34;https://rsproxy.cn/rustup\u0026#34; 安装 1 2 curl --proto \u0026#39;=https\u0026#39; --tlsv1.2 -sSf https://rsproxy.cn/rustup-init.sh | sh # windows直接使用官网下载的rustup-init.exe即可 设置cargo.io镜像，修改配置 ~/.cargo/config.toml，已支持git协议和sparse协议，\u0026gt;=1.68 版本建议使用 sparse-index，速度更快。 sparse 1 2 3 4 5 6 7 8 9 10 [source.crates-io] replace-with = \u0026#39;rsproxy-sparse\u0026#39; [source.rsproxy] registry = \u0026#34;https://rsproxy.cn/crates.io-index\u0026#34; [source.rsproxy-sparse] registry = \u0026#34;sparse+https://rsproxy.cn/index/\u0026#34; [registries.rsproxy] index = \u0026#34;https://rsproxy.cn/crates.io-index\u0026#34; [net] git-fetch-with-cli = true rsproxy 1 2 3 4 5 6 7 8 9 10 [source.crates-io] replace-with = \u0026#39;rsproxy\u0026#39; [source.rsproxy] registry = \u0026#34;https://rsproxy.cn/crates.io-index\u0026#34; [source.rsproxy-sparse] registry = \u0026#34;sparse+https://rsproxy.cn/index/\u0026#34; [registries.rsproxy] index = \u0026#34;https://rsproxy.cn/crates.io-index\u0026#34; [net] git-fetch-with-cli = true ","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/rust/%E5%9B%BD%E5%86%85%E6%BA%90%E5%AE%89%E8%A3%85/","summary":"\u003col\u003e\n\u003cli\u003eRustup 镜像， 修改配置 ~/.zshrc or ~/.bashrc，windows直接配置环境变量\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eRUSTUP_DIST_SERVER\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;https://rsproxy.cn\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eRUSTUP_UPDATE_ROOT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;https://rsproxy.cn/rustup\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003col start=\"2\"\u003e\n\u003cli\u003e安装\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecurl --proto \u003cspan class=\"s1\"\u003e\u0026#39;=https\u0026#39;\u003c/span\u003e --tlsv1.2 -sSf https://rsproxy.cn/rustup-init.sh \u003cspan class=\"p\"\u003e|\u003c/span\u003e sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# windows直接使用官网下载的rustup-init.exe即可\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003col start=\"3\"\u003e\n\u003cli\u003e设置cargo.io镜像，修改配置 ~/.cargo/config.toml，已支持git协议和sparse协议，\u0026gt;=1.68 版本建议使用 sparse-index，速度更快。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003esparse\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-toml\" data-lang=\"toml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003esource\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecrates-io\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ereplace-with\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;rsproxy-sparse\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003esource\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ersproxy\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eregistry\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;https://rsproxy.cn/crates.io-index\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003esource\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ersproxy-sparse\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eregistry\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;sparse+https://rsproxy.cn/index/\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eregistries\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ersproxy\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;https://rsproxy.cn/crates.io-index\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003enet\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003egit-fetch-with-cli\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cul\u003e\n\u003cli\u003ersproxy\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-toml\" data-lang=\"toml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003esource\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecrates-io\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ereplace-with\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;rsproxy\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003esource\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ersproxy\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eregistry\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;https://rsproxy.cn/crates.io-index\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003esource\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ersproxy-sparse\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eregistry\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;sparse+https://rsproxy.cn/index/\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eregistries\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ersproxy\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;https://rsproxy.cn/crates.io-index\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003enet\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003egit-fetch-with-cli\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"Rust国内源安装"},{"content":"1. 离线安装 下载rust安装包: 链接 比如 x86_64-unknown-linux-gnu | x86_64-pc-windows-msvc 下载源码，https://static.rust-lang.org/dist/rustc-1.80.0-src.tar.xz ， 中间的版本号根据下载的安装包改变 执行安装包(windows)或解压执行安装脚本 解压源码（应该是名为 rustc-x.x.x-src 的文件夹），将该文件夹更名为rust， 然后在rust安装目录的rustlib目录下新建src目录，再将刚更名的rust目录移入src目录下 windows：rust安装目录\\lib\\rustlib\\\nlinux: /usr/local/lib/rustlib/\n2. 离线编译Rust项目 在 Rust 项目中实现离线编译开发，可通过以下步骤缓存依赖并迁移至内网：\n生成依赖锁定文件 1 cargo generate-lockfile 确保 Cargo.lock 文件存在，锁定所有依赖版本\n使用 vendor 命令本地化依赖 1 cargo vendor --locked 该命令会：\n创建 vendor/ 目录包含所有 crates.io 依赖 自动生成 .cargo/config.toml 配置指向本地依赖 --locked 参数确保使用精确的锁定版本 2.1. 运行 cargo vendor 并指定目标\n1 2 3 4 5 6 # 设置目标平台 set CARGO_BUILD_TARGET=x86_64-unknown-linux-musl # Windows CMD $env:CARGO_BUILD_TARGET=\u0026#34;x86_64-unknown-linux-musl\u0026#34; # PowerShell # 下载依赖到 vendor 目录 cargo vendor --versioned-dirs --respect-source-config \u0026ndash;versioned-dirs：为依赖目录添加版本后缀（如 serde-1.0.0），便于识别。 \u0026ndash;respect-source-config：兼容已有的 [source] 配置。 处理 Git 依赖 在 .cargo/config.toml 中添加： 1 2 3 4 5 6 7 8 9 10 [source.crates-io] replace-with = \u0026#34;vendored-sources\u0026#34; [source.vendored-sources] directory = \u0026#34;vendor\u0026#34; # 替换所有 git 源为本地路径 [source.\u0026#34;https://github.com/your_org/crates.git\u0026#34;] replace-with = \u0026#34;vendored-sources\u0026#34; local-registry = \u0026#34;path/to/local/git/crates\u0026#34; 打包完整项目 1 2 3 4 tar czf project.tar.gz \\ Cargo.toml Cargo.lock src/ \\ vendor/ .cargo/config.toml \\ path/to/local/git/crates/ 内网环境配置 解压后执行： 1 2 3 4 5 # 设置离线模式 echo \u0026#39;net.offline = true\u0026#39; \u0026gt;\u0026gt; .cargo/config.toml # 编译验证 cargo build --offline 增量更新方案（可选） 在外网创建更新补丁： 1 2 3 4 5 6 7 # 生成补丁包 cargo vendor --locked | grep \u0026#39;New\u0026#39; \u0026gt; new_deps.list tar czf update_$(date +%F).tar.gz -T new_deps.list # 内网应用更新 rsync -avhP update.tar.gz intranet:/project/ tar xzf update.tar.gz \u0026amp;\u0026amp; cargo build --offline 关键配置详解：\n1 2 3 4 5 6 7 8 9 10 11 12 13 # .cargo/config.toml [source] # 禁用默认源 crates-io = false # 本地 vendor 源 [source.vendored-sources] directory = \u0026#34;vendor\u0026#34; # 替换 git 依赖为本地路径 [source.\u0026#34;https://github.com/private/repo.git\u0026#34;] git = \u0026#34;file:///opt/internal/crates/private-repo\u0026#34; branch = \u0026#34;main\u0026#34; 注意事项：\n使用 --offline 参数时必须存在有效的 Cargo.lock 对于包含 build script 的 crate，需预编译其 native 依赖 跨平台编译时需同步 ~/.cargo/registry/cache/ 和 ~/.cargo/registry/src/ 建议使用相同 Rust 工具链版本 进阶方案： 对于企业级开发，建议搭建私有 Cargo 注册表：\n使用 crates.io 镜像工具 或 Artifactory 配置 CI/CD 自动同步公共 crate 到内网 通过 cargo login --registry intranet 设置访问凭证 完整操作示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # 外网环境准备 export CARGO_HOME=$(pwd)/.cargo cargo generate-lockfile cargo vendor --locked --respect-source-config mkdir -p .cargo cat \u0026lt;\u0026lt;EOF \u0026gt; .cargo/config.toml [source.crates-io] replace-with = \u0026#34;vendored-sources\u0026#34; [source.vendored-sources] directory = \u0026#34;vendor\u0026#34; [net] offline = true EOF # 打包传输 tar czf project.tgz .cargo Cargo.* src/ vendor/ # 内网环境 tar xzf project.tgz CARGO_HOME=$(pwd)/.cargo cargo build --offline 该方案已在多个金融级开发环境中验证，可支持包含 1000+ 依赖项的大型项目离线编译。\n","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/rust/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E5%8F%8A%E7%A6%BB%E7%BA%BF%E4%BE%9D%E8%B5%96/","summary":"\u003ch1 id=\"1-离线安装\"\u003e1. 离线安装\u003c/h1\u003e\n\u003col\u003e\n\u003cli\u003e下载rust安装包: \u003ca href=\"https://forge.rust-lang.org/infra/archive-stable-version-installers.html\"\u003e链接\u003c/a\u003e 比如 x86_64-unknown-linux-gnu  |  x86_64-pc-windows-msvc\u003c/li\u003e\n\u003cli\u003e下载源码，https://static.rust-lang.org/dist/rustc-1.80.0-src.tar.xz ， 中间的版本号根据下载的安装包改变\u003c/li\u003e\n\u003cli\u003e执行安装包(windows)或解压执行安装脚本\u003c/li\u003e\n\u003cli\u003e解压源码（应该是名为 rustc-x.x.x-src 的文件夹），将该文件夹更名为rust，\u003c/li\u003e\n\u003cli\u003e然后在rust安装目录的rustlib目录下新建src目录，再将刚更名的rust目录移入src目录下\u003c/li\u003e\n\u003c/ol\u003e\n\u003cblockquote\u003e\n\u003cp\u003ewindows：rust安装目录\\lib\\rustlib\\\u003c/p\u003e","title":"Rust离线环境安装及使用vendor离线编译项目"},{"content":"减库存案例 1. 同步锁 优点： 简单，能解决问题 缺点：仅适合单个服务，多服务进程时失效\n2. 分布式锁 注意\n锁持有者归属 各个操作锁的地方需要保证原子性 需要考虑进程挂掉后锁超时 需要考虑锁续命 Redisson分布式锁使用\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 RLock lock = null; try { lock = redissonClient.getLock(lock_name); lock.lock(); /* 业务代码 */ } finally { if (lock != null) { lock.unlock(); } } Redisson分布式锁原理： Redisson底层上锁实际上是执行lua脚本\n先设置指定锁名，及其对应值 1， （kv结构且值为数值，以方便锁重入） 设置超时时间 1 2 3 4 5 6 7 8 9 -- KEYS[1] 表示锁在redis中的key -- ARGV[1] 是超时时间 -- ARGV[2] 是锁加锁的名字（线程/进程ID） if ((redis.call(\u0026#39;exists\u0026#39;, KEYS[1]) == 0) or (redis.call(\u0026#39;hexists\u0026#39;, KEYS[1], ARGV[2]) == 1)) then redis.call(\u0026#39;hincrby\u0026#39;, KEYS[1], ARGV[2], 1); redis.call(\u0026#39;pexpire\u0026#39;, KEYS[1], ARGV[1]); return nil; end; return redis.call(\u0026#39;pttl\u0026#39;, KEYS[1]); 获取锁成功后会定时（超时时间 / 3）去刷新超时时间，保持心跳 1 2 3 4 5 6 7 8 -- KEYS[1] 表示锁在redis中的key -- ARGV[1] 是超时时间 -- ARGV[2] 是锁加锁的名字（线程/进程ID） if (redis.call(\u0026#39;hexists\u0026#39;, KEYS[1], ARGV[2]) == 1) then redis.call(\u0026#39;pexpire\u0026#39;, KEYS[1], ARGV[1]); return 1; end; return 0; 问题1：性能问题，上锁导致的性能问题如何尽量优化 使用分段锁思路，拆分成多段锁，比如200库存拆分成10个段，每段20个库存，分开上锁 使用redis的CAS操作（底层依旧是执行lua脚本实现）替换 读取-修改-保存 这一套操作\n问题2：Redis集群环境下，主节点挂掉时引发锁丢失问题解决 解决方法：\n使用zookeeper（CP）替换redis（AP）来做分布式锁（使用CP特性） Redlock: 使用Redlock解决，实现方式与zookeeper类似（半数以上节点加锁成功才会返回成功）（！但不推荐使用） 3. 缓存数据库双写不一致 写库和写缓存之间，其他线程先一步执行完写缓存了，则会导致新数据被覆盖 直接改为写库后删除缓存，让其在读取时重新获取 读取时，去获取库中数据并写入缓存期间，被其他写线程先一步写入其他数据，则会导致缓存中的数据并非最新数据 延迟双删（不一定100%解决，不太建议，弊端很大） 队列化处理（实现偏复杂，且有去重等其他新问题） 乐观锁（会导致大量的写失败！！！） 使用分布式锁解决（读写锁，读多写少场景使用） 在更新缓存时，设置超时时间（适合读多写多场景） 了解canal（适合读多写多场景，且一定要使用缓存场景） ","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/open_source_component/redis/redis_concurrency_case/","summary":"\u003ch1 id=\"减库存案例\"\u003e减库存案例\u003c/h1\u003e\n\u003ch2 id=\"1-同步锁\"\u003e1. 同步锁\u003c/h2\u003e\n\u003cp\u003e优点： 简单，能解决问题\n缺点：仅适合单个服务，多服务进程时失效\u003c/p\u003e\n\u003ch2 id=\"2-分布式锁\"\u003e2. 分布式锁\u003c/h2\u003e\n\u003cp\u003e注意\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e锁持有者归属\u003c/li\u003e\n\u003cli\u003e各个操作锁的地方需要保证原子性\u003c/li\u003e\n\u003cli\u003e需要考虑进程挂掉后锁超时\u003c/li\u003e\n\u003cli\u003e需要考虑锁续命\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003eRedisson分布式锁使用\u003c/p\u003e","title":"Redis并发相关使用案例"},{"content":"Maven国内源配置 修改Maven中的配置文件。 进入Mavne的安装路径也就是解压路径，例如D:\\apache-maven-3.5.4\\conf。修改D:\\apache-maven-3.5.4\\conf下的settings.xml文件\n找到\u0026lt;mirrors\u0026gt;\u0026lt;/mirrors\u0026gt;标签，在其中配置阿里云镜像。 1 2 3 4 5 6 7 8 9 \u0026lt;mirrors\u0026gt; \u0026lt;!--下面是配置内容--\u0026gt; \u0026lt;mirror\u0026gt; \u0026lt;id\u0026gt;alimaven\u0026lt;/id\u0026gt; \u0026lt;mirrorOf\u0026gt;central\u0026lt;/mirrorOf\u0026gt; \u0026lt;name\u0026gt;aliyun maven\u0026lt;/name\u0026gt; \u0026lt;url\u0026gt;http://maven.aliyun.com/nexus/content/repositories/central/\u0026lt;/url\u0026gt; \u0026lt;/mirror\u0026gt; \u0026lt;/mirrors\u0026gt; 1 2 3 4 5 6 7 8 \u0026lt;mirrors\u0026gt; \u0026lt;mirror\u0026gt; \u0026lt;id\u0026gt;aliyun-public\u0026lt;/id\u0026gt; \u0026lt;mirrorOf\u0026gt;*\u0026lt;/mirrorOf\u0026gt; \u0026lt;name\u0026gt;aliyun public\u0026lt;/name\u0026gt; \u0026lt;url\u0026gt;https://maven.aliyun.com/repository/public\u0026lt;/url\u0026gt; \u0026lt;/mirror\u0026gt; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 \u0026lt;/mirrors\u0026gt; \u0026lt;profile\u0026gt; \u0026lt;repositories\u0026gt; \u0026lt;repository\u0026gt; \u0026lt;id\u0026gt;google\u0026lt;/id\u0026gt; \u0026lt;url\u0026gt;https://maven.aliyun.com/repository/google\u0026lt;/url\u0026gt; \u0026lt;releases\u0026gt; \u0026lt;enabled\u0026gt;true\u0026lt;/enabled\u0026gt; \u0026lt;/releases\u0026gt; \u0026lt;snapshots\u0026gt; \u0026lt;enabled\u0026gt;true\u0026lt;/enabled\u0026gt; \u0026lt;/snapshots\u0026gt; \u0026lt;/repository\u0026gt; \u0026lt;repository\u0026gt; \u0026lt;id\u0026gt;gradle-plugin\u0026lt;/id\u0026gt; \u0026lt;url\u0026gt;https://maven.aliyun.com/repository/gradle-plugin\u0026lt;/url\u0026gt; \u0026lt;releases\u0026gt; \u0026lt;enabled\u0026gt;true\u0026lt;/enabled\u0026gt; \u0026lt;/releases\u0026gt; \u0026lt;snapshots\u0026gt; \u0026lt;enabled\u0026gt;true\u0026lt;/enabled\u0026gt; \u0026lt;/snapshots\u0026gt; \u0026lt;/repository\u0026gt; \u0026lt;repository\u0026gt; \u0026lt;id\u0026gt;spring\u0026lt;/id\u0026gt; \u0026lt;url\u0026gt;https://maven.aliyun.com/repository/spring\u0026lt;/url\u0026gt; \u0026lt;releases\u0026gt; \u0026lt;enabled\u0026gt;true\u0026lt;/enabled\u0026gt; \u0026lt;/releases\u0026gt; \u0026lt;snapshots\u0026gt; \u0026lt;enabled\u0026gt;true\u0026lt;/enabled\u0026gt; \u0026lt;/snapshots\u0026gt; \u0026lt;/repository\u0026gt; \u0026lt;repository\u0026gt; \u0026lt;id\u0026gt;spring-plugin\u0026lt;/id\u0026gt; \u0026lt;url\u0026gt;https://maven.aliyun.com/repository/spring-plugin\u0026lt;/url\u0026gt; \u0026lt;releases\u0026gt; \u0026lt;enabled\u0026gt;true\u0026lt;/enabled\u0026gt; \u0026lt;/releases\u0026gt; \u0026lt;snapshots\u0026gt; \u0026lt;enabled\u0026gt;true\u0026lt;/enabled\u0026gt; \u0026lt;/snapshots\u0026gt; \u0026lt;/repository\u0026gt; \u0026lt;repository\u0026gt; \u0026lt;id\u0026gt;grails-core\u0026lt;/id\u0026gt; \u0026lt;url\u0026gt;https://maven.aliyun.com/repository/grails-core\u0026lt;/url\u0026gt; \u0026lt;releases\u0026gt; \u0026lt;enabled\u0026gt;true\u0026lt;/enabled\u0026gt; \u0026lt;/releases\u0026gt; \u0026lt;snapshots\u0026gt; \u0026lt;enabled\u0026gt;true\u0026lt;/enabled\u0026gt; \u0026lt;/snapshots\u0026gt; \u0026lt;/repository\u0026gt; \u0026lt;/repositories\u0026gt; \u0026lt;/profile\u0026gt; Gradle国内源配置 针对单个项目比较简单： 1 2 3 4 5 6 7 8 9 10 repositories { maven { url \u0026#39;https://maven.aliyun.com/repository/public/\u0026#39; } maven { url \u0026#39;https://maven.aliyun.com/repository/spring/\u0026#39; } mavenLocal() mavenCentral() } 针对全局项目 在GRADLE_HOME/init.d/目录下新建文件：init.gradle\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 allprojects { repositories { mavenLocal() maven { url \u0026#39;https://maven.aliyun.com/repository/public/\u0026#39; } maven { url \u0026#39;https://maven.aliyun.com/repository/spring/\u0026#39;} maven { url \u0026#39;https://maven.aliyun.com/repository/google/\u0026#39;} maven { url \u0026#39;https://maven.aliyun.com/repository/gradle-plugin/\u0026#39;} maven { url \u0026#39;https://maven.aliyun.com/repository/spring-plugin/\u0026#39;} maven { url \u0026#39;https://maven.aliyun.com/repository/grails-core/\u0026#39;} maven { url \u0026#39;https://maven.aliyun.com/repository/apache-snapshots/\u0026#39;} mavenCentral() } } ","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/java/maven_gradle_mirror/","summary":"\u003ch1 id=\"maven国内源配置\"\u003eMaven国内源配置\u003c/h1\u003e\n\u003ch2 id=\"修改maven中的配置文件\"\u003e修改Maven中的配置文件。\u003c/h2\u003e\n\u003cp\u003e进入Mavne的安装路径也就是解压路径，例如\u003ccode\u003eD:\\apache-maven-3.5.4\\conf\u003c/code\u003e。修改\u003ccode\u003eD:\\apache-maven-3.5.4\\conf\u003c/code\u003e下的\u003ccode\u003esettings.xml\u003c/code\u003e文件\u003c/p\u003e","title":"Maven、Gradle国内源配置"},{"content":"hugo图片引入问题 我在使用hugo写笔记的时候遇到了插入图片出现链接失效问题，因为在hugo中 xxx.md 生成html后会生成 xxx 目录，然后再 xxx 目录下生成 index.html ，因此编写md时的图片引用路径在生成html后边的不可用了；\n网上查到的解决方法有两种：\n图片放入 /static 目录下，然后通过绝对路径引入 将 xxx.md 调整为 xxx/index.md 然后使用相对路径引用图片 但是：方法一需要把所有图片放到 /static 下，需要单独维护；方法二会导致出现大量目录和 index.md 文件，目录就会非常乱。\n故而想了一种办法：通过修改md生成html时图片渲染处理逻辑，以支持相对路径图片引用\n修改 render_image.html (/layouts/_default/_markup/render_image.html)\n默认可能没有，我的是从 PaperMod 主题里复制的\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 {{- $u := urls.Parse .Destination -}} {{- $src := $u.String -}} {{- if not $u.IsAbs -}} {{- $path := strings.TrimPrefix \u0026#34;./\u0026#34; $u.Path }} {{- with or (.PageInner.Resources.Get $path) (resources.Get $path) -}} {{- $src = .RelPermalink -}} {{- with $u.RawQuery -}} {{- $src = printf \u0026#34;%s?%s\u0026#34; $src . -}} {{- end -}} {{- with $u.Fragment -}} {{- $src = printf \u0026#34;%s#%s\u0026#34; $src . -}} {{- end -}} {{/* 新增逻辑：非 index.md 的本地相对路径添加 ../ */}} {{- else -}} {{- if and (not (hasPrefix $u.Path \u0026#34;/\u0026#34;)) (ne .PageInner.File.LogicalName \u0026#34;index.md\u0026#34;) -}} {{- $src = printf \u0026#34;../%s\u0026#34; $path -}} {{- end -}} {{- end -}} {{- 一直到这里 -}} {{- end -}} {{- $attributes := merge .Attributes (dict \u0026#34;alt\u0026#34; .Text \u0026#34;src\u0026#34; $src \u0026#34;title\u0026#34; (.Title | transform.HTMLEscape) \u0026#34;loading\u0026#34; \u0026#34;lazy\u0026#34;) -}} \u0026lt;img {{- range $k, $v := $attributes -}} {{- if $v -}} {{- printf \u0026#34; %s=%q\u0026#34; $k $v | safeHTMLAttr -}} {{- end -}} {{- end -}}\u0026gt; {{- /**/ -}} 这样你就可以直接在 xxx.md 中直接使用 img/xxx_1.1.png 引入图片了\n","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/other_general/hugo/hugo_include_image/","summary":"\u003ch1 id=\"hugo图片引入问题\"\u003ehugo图片引入问题\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e我在使用hugo写笔记的时候遇到了插入图片出现链接失效问题，因为在hugo中 xxx.md 生成html后会生成 xxx 目录，然后再 xxx 目录下生成 index.html ，因此编写md时的图片引用路径在生成html后边的不可用了；\u003c/p\u003e","title":"hugo从同级目录下插入图片（相对路径）"},{"content":"杂项记录点 1. 命令 编写时可启动 server 随时观察实际显示效果： 1 hugo server 编译 1 hugo --gc --minify --cleanDestinationDir 2. md开头的参数 date\n• 文章发布日期，格式为 YYYY-MM-DDTHH:mm:ss+08:00（ISO 8601）。\n• 用途：决定文章在时间轴中的位置，影响排序和归档路径。\n• 示例：date: 2025-07-21T14:30:00+08:00\ndraft\n• 布尔值（true/false），标记是否为草稿。\n• 用途：若为 true，默认情况下 hugo 命令不会生成该文章，需添加 \u0026ndash;buildDrafts 参数才能编译。\n• 示例：draft: true\ndescription\n• 文章摘要或描述，通常用于 SEO 和列表页预览。\n• 示例：description: \u0026ldquo;Hugo Front Matter 参数详解\u0026rdquo;\nauthor\n• 指定作者姓名，可在模板中调用显示。\n• 示例：author: \u0026ldquo;Your Name\u0026rdquo;\nimage\n• 文章封面或特色图片路径（支持本地或外部 URL）。\n• 示例：image: \u0026ldquo;/images/featured.jpg\u0026rdquo;\nsummary\n• 手动指定文章摘要，覆盖自动生成的摘要。\n• 示例：summary: \u0026ldquo;本文详细解析 Hugo Front Matter 的所有参数\u0026rdquo;\ntoc\n• 布尔值（true/false），控制是否生成目录（Table of Contents）。\n• 示例：toc: true\nweight\n• 数值，控制文章在列表中的排序权重（数值越小越靠前）。\n• 示例：weight: 10\nhiddenFromHomePage / hiddenFromSearch\n• 布尔值，控制文章是否在首页或搜索结果中隐藏。\n• 示例：hiddenFromHomePage: true\nmath\n• 布尔值，启用数学公式支持（需主题兼容 LaTeX）。\n• 示例：math: true\nlightgallery\n• 布尔值，启用图片灯箱效果（依赖主题实现）。\n• 示例：lightgallery: true\naliases\n• 数组，设置文章别名（旧 URL 重定向）。\n• 示例：\naliases:\n\u0026ldquo;/old-path/post.html\u0026rdquo; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 title: \u0026#34;{{ replace .Name \u0026#34;-\u0026#34; \u0026#34; \u0026#34; | title }}\u0026#34; date: {{ .Date }} lastmod: {{ .Date }} author: [\u0026#34;AInfinity\u0026#34;] categories: - category 1 - category 2 tags: - tag 1 - tag 2 keywords: - word 1 - word 2 description: \u0026#34;\u0026#34; # 文章描述，与搜索优化相关 summary: \u0026#34;\u0026#34; # 文章简单描述，会展示在主页 weight: # 输入1可以顶置文章，用来给文章展示排序，不填就默认按时间排序 slug: \u0026#34;\u0026#34; draft: false # 是否为草稿 comments: true showToc: true # 显示目录 TocOpen: true # 自动展开目录 autonumbering: true # 目录自动编号 hidemeta: false # 是否隐藏文章的元信息，如发布日期、作者等 disableShare: true # 底部不显示分享栏 searchHidden: false # 该页面可以被搜索到 showbreadcrumbs: true #顶部显示当前路径 mermaid: true cover: image: \u0026#34;\u0026#34; caption: \u0026#34;\u0026#34; alt: \u0026#34;\u0026#34; relative: false ","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/other_general/hugo/hugo_exp_note/","summary":"hugo使用过程中的一些经验记录","title":"hugo使用经验"},{"content":"","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/other_general/hugo/hugo_giscus_comment/","summary":"","title":"hugo使用Giscus支持评论"},{"content":"settings.json 配置 通过添加 .vscode/settings.json 来配置 vscode ， 比如使 Markdown 支持代码片段和提示：\n1 2 3 4 5 6 7 8 9 { \u0026#34;[markdown]\u0026#34;: { \u0026#34;editor.quickSuggestions\u0026#34;: { \u0026#34;other\u0026#34;: true, // 允许代码片段在非注释/字符串区域触发 \u0026#34;comments\u0026#34;: false, \u0026#34;strings\u0026#34;: false } } } *.code-snippets 代码片段 通过添加 .vscode/xxx.code-snippets 来添加自定义代码片段：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 { \u0026#34;Hugo Title\u0026#34;: { \u0026#34;prefix\u0026#34;: \u0026#34;hugo\u0026#34;, // 触发词，如输入\u0026#34;time\u0026#34;后按Tab \u0026#34;body\u0026#34;: [ \u0026#34;---\u0026#34;, \u0026#34;title: \u0026#39;标题\u0026#39;\u0026#34;, \u0026#34;author: [\u0026#39;kyle\u0026#39;]\u0026#34;, \u0026#34;summary: \u0026#39;简单描述\u0026#39;\u0026#34;, \u0026#34;date: \u0026#39;${CURRENT_YEAR}-${CURRENT_MONTH}-${CURRENT_DATE}T${CURRENT_HOUR}:${CURRENT_MINUTE}:${CURRENT_SECOND}+08:00\u0026#39;\u0026#34;, \u0026#34;draft: true\u0026#34;, \u0026#34;---\u0026#34;, \u0026#34;\u0026#34; ], \u0026#34;description\u0026#34;: \u0026#34;hugo md 开头配置\u0026#34; } } ","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/vscode/vscode-project-config/","summary":"[此文为随笔随记]通过对项目下的 .vscode 目录添加配置达到项目级配置的目的，这样就不用每个环境都修改配置了","title":"vscode项目级配置"},{"content":"1. Hugo部分 1.1. 安装Hugo https://github.com/gohugoio/hugo/releases/latest\n根据自己的操作系统下载 hugo_extended_withdeploy_xxx，我这里是Ubuntu，所以下载的 hugo_extended_withdeploy_0.147.3_linux-amd64.deb\n1.2. Hugo创建站点（项目） Hugo 默认配置文件格式是.toml，但.yml格式更易看懂，更好配置，所以我这里使用的yml格式配置文件\n1 hugo new site Kyle-Derrick.github.io -f yml 完事后生成一个Kyle-Derrick.github.io目录，进入目录后是如下结构：\n1 2 3 4 5 6 7 8 9 10 11 Kyle-Derrick.github.io/ ├── archetypes/ │ └── default.md ├── assets/ ├── content/ ├── data/ ├── i18n/ ├── layouts/ ├── static/ ├── themes/ └── hugo.yml \u0026lt;-- site configuration 目录说明：\n文件名称 简要说明 archetypes 该文件夹主要用来存储博客生成的模板文件，初次使用只有一个default.md，可以根据个人的主题配置添加自定义头部信息 assets 该文件夹主要用于保存博客样式css和js文件 content 保存个人博客所有内容 data 保存生成站点时候所需要的配置文件 layouts 以为.html形式存储模板，将你博客内容呈现为静态页面 static 存储所有静态内容：图片、.css、.js等，当使用 Hugo 生成静态页面时，所有内容将会被复制 resources 缓存一些文件来加速站点生成 themes 保存主题 config.yml 个人博客主题样式配置文件 引入 PaperMod 主题项目 1 2 3 git submodule add --depth=1 https://github.com/adityatelange/hugo-PaperMod.git themes/PaperMod git submodule update --init --recursive 1.3. 编辑 config.yml 文件 可以参考官方的进行修改：https://github.com/adityatelange/hugo-PaperMod/wiki/Installation#sample-hugoyml\n我这里根据网上找的案例然后简单改了改：\n注意里边的 publishDir: \u0026quot;docs\u0026quot; 后边Github Pages时有用\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 baseURL: https://Kyle-Derrick.github.io # 绑定的域名 title: Kyle\u0026#39;s Notebook publishDir: \u0026#34;docs\u0026#34; # paginate: 10 # 首页每页显示的文章数 theme: PaperMod # 主题名称，和themes文件夹下的一致 languageCode: zh-cn # en-us # 网站默认语言为简体中文 pagination: pagerSize: 10 # 控制每页显示数量 path: \u0026#34;page/\u0026#34; # 可选：分页路径格式 hasCJKLanguage: true # 自动检测是否包含中文日文韩文,如果文章中使用了很多中文引号的话可以开启（解决中文引号排版问题） enableInlineShortcodes: true # 允许行内短代码 enableEmoji: true # 允许使用 Emoji 表情，建议 true enableRobotsTXT: true # 生成 robots.txt 文件 buildDrafts: false # 不构建草稿文章 buildFuture: false # 不构建未来日期的文章 buildExpired: false # 不构建已过期的文章 pygmentsUseClasses: true # 使用 CSS 类而非内联样式（代码高亮） # googleAnalytics: UA-123-45 minify: disableXML: true # 禁用 XML 压缩 # minifyOutput: true permalinks: post: \u0026#34;/:title/\u0026#34; # post: \u0026#34;/:year/:month/:day/:title/\u0026#34; defaultContentLanguage: zh # 最顶部首先展示的语言页面 defaultContentLanguageInSubdir: true # 每种语言生成独立子目录（如 /zh/） languages: zh: languageName: \u0026#34;Chinese\u0026#34; # 显示在语言切换器中的名称 # contentDir: content/english weight: 1 # 权重最高（默认语言） outputs: home: - HTML - RSS # 生成 RSS 订阅源 - JSON # 生成 JSON Feed menu: main: - identifier: search name: 搜索 url: search weight: 1 - identifier: home name: 主页 url: / weight: 2 - identifier: posts name: 文章 url: /posts weight: 3 - identifier: archives name: 时间轴 url: archives weight: 20 # - identifier: categories # name: 🧩分类 # url: categories # weight: 30 - identifier: tags name: 标签 url: /tags weight: 40 - identifier: about name: 关于 url: /about weight: 50 # - identifier: links # name: 🤝友链 # url: links # weight: 60 params: env: production # to enable google analytics, opengraph, twitter-cards and schema. description: \u0026#34;这是一个纯粹的博客......\u0026#34; author: Shaohan Tian author: \u0026#34;Me\u0026#34; # author: [\u0026#34;Me\u0026#34;, \u0026#34;You\u0026#34;] # multiple authors defaultTheme: auto # 自动切换深色/浅色模式 disableThemeToggle: false # 允许用户手动切换主题 DateFormat: \u0026#34;2006-01-02\u0026#34; ShowShareButtons: true ShowReadingTime: true # disableSpecialistPost: true displayFullLangName: true ShowPostNavLinks: true ShowBreadCrumbs: true ShowCodeCopyButtons: true # 显示代码复制按钮 hideFooter: false # 隐藏页脚 ShowWordCounts: true VisitCount: true ShowLastMod: true #显示文章更新时间 ShowToc: true # 显示目录 TocOpen: true # 自动展开目录 comments: true # 个人资料模块配置 profileMode: enabled: true title: 平平无奇的记忆碎片收纳墙 # 个人简介标题 subtitle: \u0026#34;欢迎光临寒舍\u0026#34; # 带 HTML 格式的副标题 # imageUrl: \u0026#34;img/logo.gif\u0026#34; # 头像图片路径 # imageTitle: # imageWidth: 150 # imageHeight: 150 buttons: # 导航按钮 - name: 技术 url: posts/tech - name: 阅读 url: posts/read - name: 生活 url: posts/life socialIcons: # 社交图标链接 - name: github url: \u0026#34;https://github.com/Kyle-Derrick\u0026#34; # - name: twitter # url: \u0026#34;img/twitter.png\u0026#34; # - name: bilibili # url: \u0026#34;https://space.bilibili.com/395280439\u0026#34; # - name: QQ # url: \u0026#34;img/qq.jpg\u0026#34; # - name: email # url: \u0026#34;mailto:shaohan.tian@foxmail.com\u0026#34; - name: RSS url: \u0026#34;index.xml\u0026#34; # - name: facebook # url: \u0026#34;https://www.facebook.com/profile.php?id=100027782410997\u0026#34; # - name: instagram # url: \u0026#34;img/instagram.png\u0026#34; # - name: QQ # url: \u0026#34;img/qq.png\u0026#34; # - name: Phone # url: \u0026#34;img/phone.png\u0026#34; # editPost: # URL: \u0026#34;https://github.com/adityatelange/hugo-PaperMod/tree/exampleSite/content\u0026#34; # Text: \u0026#34;Suggest Changes\u0026#34; # edit text # appendFilePath: true # to append file path to Edit link # label: # text: \u0026#34;Home\u0026#34; # icon: icon.png # iconHeight: 35 # analytics: # google: # SiteVerificationTag: \u0026#34;XYZabc\u0026#34; assets: favicon: \u0026#34;img/favicon.ico\u0026#34; favicon16x16: \u0026#34;img/favicon-16x16.ico\u0026#34; favicon32x32: \u0026#34;img/favicon-32x32.ico\u0026#34; apple_touch_icon: \u0026#34;img/apple-touch-icon.png\u0026#34; safari_pinned_tab: \u0026#34;img/favicon.ico\u0026#34; # cover: # hidden: true # hide everywhere but not in structured data # hiddenInList: true # hide on list pages and home # hiddenInSingle: true # hide on single page fuseOpts: # 搜索功能配置 isCaseSensitive: false # 不区分大小写 shouldSort: true location: 0 distance: 1000 threshold: 0.1 # 搜索敏感度 minMatchCharLength: 0 keys: [\u0026#34;title\u0026#34;, \u0026#34;permalink\u0026#34;, \u0026#34;summary\u0026#34;] twikoo: version: 1.4.11 taxonomies: category: categories # 分类系统使用 /categories/ 路径 tag: tags # 标签系统使用 /tags/ 路径 series: series # 系列文章使用 /series/ 路径 markup: goldmark: renderer: unsafe: true # HUGO 默认转义 Markdown 文件中的 HTML 代码，如需开启的话 highlight: # anchorLineNos: true codeFences: true guessSyntax: true lineNos: true # 显示行号 # noClasses: false # style: monokai style: darcula # 代码高亮主题为 Darcula # codeFences：代码围栏功能，这个功能一般都要设为 true 的，不然很难看，就是干巴巴的-代码文字，没有颜色。 # guessSyntax：猜测语法，这个功能建议设置为 true, 如果你没有设置要显示的语言则会自动匹配。 # hl_Lines：高亮的行号，一般这个不设置，因为每个代码块我们可能希望让高亮的地方不一样。 # lineNoStart：行号从编号几开始，一般从 1 开始。 # lineNos：是否显示行号，我比较喜欢显示，所以我设置的为 true. # lineNumbersInTable：使用表来格式化行号和代码,而不是 标签。这个属性一般设置为 true. # noClasses：使用 class 标签，而不是内嵌的内联样式 privacy: # 隐私相关设置 vimeo: disabled: false simple: true x: disabled: false enableDNT: true simple: true instagram: disabled: false simple: true youtube: disabled: false privacyEnhanced: true # 启用 YouTube 隐私增强模式 services: instagram: disableInlineCSS: true x: disableInlineCSS: true 1.4. 添加搜索页面 添加以下配置到 config.yml 文件（上述配置文件已有，此处不用重复添加）\n1 2 3 4 5 outputs: home: - HTML - RSS - JSON # is necessary 在content文件夹中创建search.md并添加以下配置：\n1 2 3 4 5 6 --- title: \u0026#34;搜索\u0026#34; # in any language you want layout: \u0026#34;search\u0026#34; # is necessary summary: \u0026#34;search\u0026#34; placeholder: \u0026#34;搜索框内的默认显示\u0026#34; --- 要使得某些特定的不被搜素到，可以在博客开头添加：\n1 searchHidden: true 1.5. 配置时间轴页面 在content文件夹中创建archive.md并添加以下配置：\n1 2 3 4 5 6 --- title: \u0026#34;时间轴\u0026#34; layout: \u0026#34;archives\u0026#34; url: \u0026#34;/archives/\u0026#34; summary: archives --- 1.6. 配置标签页面 1.6.1 修改默认翻译 在项目根目录新建i18n/文件夹，复制themes/PaperMod/i18n/zh.yaml到i18n/zh.yaml\n1.6.2 修改 html 模板 标签页对应的模板文件为themes/PaperMod/layouts/_default/terms.html，同以上步骤：在网站根目录新建layouts/_default/文件夹，复制themes/PaperMod/layouts/_default/terms.html到layouts/_default/terms.html，并编辑（主要添加标签那几行）\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 {{- define \u0026#34;main\u0026#34; }} {{- if .Title }} \u0026lt;header class=\u0026#34;page-header\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;{{ .Title }}\u0026lt;/h1\u0026gt; {{- if eq .Title \u0026#34;Tags\u0026#34; }} \u0026lt;h1\u0026gt;{{ \u0026#34;标签\u0026#34; }}\u0026lt;/h1\u0026gt; \u0026lt;!-- \u0026lt;h1\u0026gt;{{ .Title }}\u0026lt;/h1\u0026gt; --\u0026gt; {{- end }} {{- if .Description }} \u0026lt;div class=\u0026#34;post-description\u0026#34;\u0026gt; {{ .Description }} \u0026lt;/div\u0026gt; {{- end }} \u0026lt;/header\u0026gt; {{- end }} \u0026lt;ul class=\u0026#34;terms-tags\u0026#34;\u0026gt; {{- $type := .Type }} {{- range $key, $value := .Data.Terms.Alphabetical }} {{- $name := .Name }} {{- $count := .Count }} {{- with site.GetPage (printf \u0026#34;/%s/%s\u0026#34; $type $name) }} \u0026lt;li\u0026gt; \u0026lt;a href=\u0026#34;{{ .Permalink }}\u0026#34;\u0026gt;{{ .Name }} \u0026lt;sup\u0026gt;\u0026lt;strong\u0026gt;\u0026lt;sup\u0026gt;{{ $count }}\u0026lt;/sup\u0026gt;\u0026lt;/strong\u0026gt;\u0026lt;/sup\u0026gt; \u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; {{- end }} {{- end }} \u0026lt;/ul\u0026gt; {{- end }}{{/* end main */ -}} 1.7. 配置关于页面 根据定义好的模板，在此利用该模板生成关于页面，根目录执行执行命令：\n1 hugo new --kind post content/about.md 1.8. 内容管理 我们写作的内容都是放在content目录下的，因此有必要对其内容有一个基本了解 在官方文档 Content Management 中详尽地介绍了管理博客内容需要了解的所有信息，以下是我的一个目录结构，其中的 about.md、 archive.md 和 search.md 对应博客中的关于、时间轴和搜索：\n1 2 3 4 5 6 7 8 9 10 11 12 content ├── posts │ ├── _index.md │ ├── life │ │ └── _index.md │ ├── read │ │ └── _index.md │ └── tech │ └── _index.md ├── about.md ├── archive.md └── search.md 以上目录结构看到出现了很多_index.md,官方参考文档在此Index Pages 。简而言之，这个文件是作为自定义索引页存在。这里给出我使用的一个_index.md作为参考：\n1 2 3 4 5 6 7 8 --- title: \u0026#34;文章\u0026#34; # description: \u0026#34;文章。\u0026#34; hidemeta: true # 是否隐藏文章的元信息，如发布日期、作者等 --- 杂七杂八的文章。 \u0026lt;!-- more --\u0026gt; 注意：根据个人博客具体分类将其生成到对应路径。\n2. Github Pages部分 2.1. 新建Github仓库 注意仓库名一定是 用户名.github.io 的形式\n2.2. 新增Github Actions 在hugo根目录新增 .github\\workflows\\deploy-hugo-and-pages.yml\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 # Simple workflow for deploying static content to GitHub Pages name: Deploy Hugo And Github Pages on: # Runs on pushes targeting the default branch push: branches: [\u0026#34;master\u0026#34;] # Allows you to run this workflow manually from the Actions tab workflow_dispatch: # Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages permissions: contents: write pages: write id-token: write # Allow only one concurrent deployment, skipping runs queued between the run in-progress and latest queued. # However, do NOT cancel in-progress runs as we want to allow these production deployments to complete. concurrency: group: \u0026#34;pages\u0026#34; cancel-in-progress: false jobs: # Single deploy job since we\u0026#39;re just deploying deploy: environment: name: github-pages url: ${{ steps.deployment.outputs.page_url }} runs-on: ubuntu-latest steps: - name: Checkout uses: actions/checkout@v4 with: submodules: true fetch-depth: 0 persist-credentials: true - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: \u0026#34;latest\u0026#34; - name: Build Web run: hugo --gc --minify --cleanDestinationDir - name: Commit artifacts run: | git config --global user.name \u0026#34;GitHub Actions Bot\u0026#34; git config --global user.email \u0026#34;github-actions@example.com\u0026#34; git add ./docs git commit -m \u0026#34;chore: Auto-commit build artifacts [skip ci]\u0026#34; || echo \u0026#34;No changes to commit\u0026#34; git push origin HEAD:master env: GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # - name: Checkout # uses: actions/checkout@v4 - name: Setup Pages uses: actions/configure-pages@v5 - name: Upload artifact uses: actions/upload-pages-artifact@v3 with: # Upload entire repository path: \u0026#39;./docs\u0026#39; - name: Deploy to GitHub Pages id: deployment uses: actions/deploy-pages@v4 2.3. 配置GitHub Pages设置 配置 Build and deployment 下的 Source 为 GitHub Actions\n完成\n","permalink":"https://Kyle-Derrick.github.io/zh/posts/tech/other_general/hugo/hugo_and_github_pages/","summary":"\u003ch1 id=\"1-hugo部分\"\u003e1. Hugo部分\u003c/h1\u003e\n\u003ch2 id=\"11-安装hugo\"\u003e1.1. 安装Hugo\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/gohugoio/hugo/releases/latest\"\u003ehttps://github.com/gohugoio/hugo/releases/latest\u003c/a\u003e\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e根据自己的操作系统下载 hugo_extended_withdeploy_xxx，我这里是Ubuntu，所以下载的 hugo_extended_withdeploy_0.147.3_linux-amd64.deb\u003c/p\u003e","title":"Hugo使用PaperMod主题搭建博客，并配置自动发布Github Pages"},{"content":"我是 Kyle，一名热爱技术分享的开发者。此站点为日常研究或学习过程中的一些记录点（或者说笔记），主要研究方向：\nRust Golang Java Python C 机器学习\n欢迎大家一起交流学习！\n","permalink":"https://Kyle-Derrick.github.io/zh/about/","summary":"关于 Kyle\u0026rsquo;s Notebook","title":"关于我"}]