<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>系统层面相关 | Kyle's Notebook</title><meta name=keywords content><meta name=description content="偏系统及底层相关"><meta name=author content="kyle"><link rel=canonical href=https://Kyle-Derrick.github.io/zh/posts/tech/system_level/><link crossorigin=anonymous href=/assets/css/stylesheet.93f625d739f1d6a5c6f20c146bc6a8d26b233492b34b2220c54b12fd46a04ded.css integrity="sha256-k/Yl1znx1qXG8gwUa8ao0msjNJKzSyIgxUsS/UagTe0=" rel="preload stylesheet" as=style><link rel=icon href=https://Kyle-Derrick.github.io/img/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://Kyle-Derrick.github.io/img/favicon-16x16.ico><link rel=icon type=image/png sizes=32x32 href=https://Kyle-Derrick.github.io/img/favicon-32x32.ico><link rel=apple-touch-icon href=https://Kyle-Derrick.github.io/img/apple-touch-icon.png><link rel=mask-icon href=https://Kyle-Derrick.github.io/img/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://Kyle-Derrick.github.io/zh/posts/tech/system_level/index.xml><link rel=alternate hreflang=zh href=https://Kyle-Derrick.github.io/zh/posts/tech/system_level/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://Kyle-Derrick.github.io/zh/posts/tech/system_level/"><meta property="og:site_name" content="Kyle's Notebook"><meta property="og:title" content="系统层面相关"><meta property="og:description" content="偏系统及底层相关"><meta property="og:locale" content="zh"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="系统层面相关"><meta name=twitter:description content="这是一个纯粹的博客......"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"文章","item":"https://Kyle-Derrick.github.io/zh/posts/"},{"@type":"ListItem","position":2,"name":"技术类","item":"https://Kyle-Derrick.github.io/zh/posts/tech/"},{"@type":"ListItem","position":3,"name":"系统层面相关","item":"https://Kyle-Derrick.github.io/zh/posts/tech/system_level/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://Kyle-Derrick.github.io/zh/ accesskey=h title="Kyle's Notebook (Alt + H)">Kyle's Notebook</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://Kyle-Derrick.github.io/zh/search title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://Kyle-Derrick.github.io/zh/ title=主页><span>主页</span></a></li><li><a href=https://Kyle-Derrick.github.io/zh/posts title=文章><span>文章</span></a></li><li><a href=https://Kyle-Derrick.github.io/zh/archives title=时间轴><span>时间轴</span></a></li><li><a href=https://Kyle-Derrick.github.io/zh/tags title=标签><span>标签</span></a></li><li><a href=https://Kyle-Derrick.github.io/zh/about title=关于><span>关于</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://Kyle-Derrick.github.io/zh/>主页</a>&nbsp;»&nbsp;<a href=https://Kyle-Derrick.github.io/zh/posts/>文章</a>&nbsp;»&nbsp;<a href=https://Kyle-Derrick.github.io/zh/posts/tech/>技术类</a></div><h1>系统层面相关</h1></header><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>如何将内存缓冲区伪装成文件流</h2></header><div class=entry-content><p>1. fmemopen（Linux POSIX 标准） 功能：将内存缓冲区伪装成文件流（FILE*），支持标准文件 I/O 操作（如 fprintf、fscanf） 核心机制： 参数：buf（预分配内存指针）、size（缓冲区大小）、mode（读写模式，如 “r+"）。 若 buf=NULL，则自动分配动态内存（需手动释放）。 应用场景： 避免磁盘 I/O：处理内存中的数据（如解析网络报文）。 兼容文件 API：第三方库仅支持 FILE* 参数时，将内存数据转为文件流。 代码示例： 1 2 3 4 5 ```c char buffer[64]; FILE *stream = fmemopen(buffer, sizeof(buffer), "w+"); fprintf(stream, "Hello, world!"); fclose(stream); // 关闭时自动添加终止符（若空间允许） 2. MemoryModule（Windows 第三方库） 功能：直接从内存加载 DLL（无需落盘），返回模块句柄供调用。 核心机制： 解析内存中的 PE 文件格式，模拟系统加载器行为（重定位、导入表修复）。 支持通过 MemoryGetProcAddress 获取函数指针。 应用场景： 加密 DLL 运行时解密：避免恶意软件扫描磁盘文件。 网络分发插件：远程下载 DLL 后直接内存加载。 对比与限制 特性 fmemopen (Linux) MemoryModule (Windows) 标准性 POSIX 标准（非全平台支持） 第三方库（非系统原生） 内存管理 需预分配缓冲区或动态分配 自动处理内存分配与重定位 安全性 缓冲区溢出风险 需自行校验内存来源合法性</p></div><footer class=entry-footer><span title='2025-07-22 22:40:49 +0800 +0800'>2025-07-22</span>&nbsp;·&nbsp;1 分钟&nbsp;·&nbsp;kyle</footer><a class=entry-link aria-label="post link to 如何将内存缓冲区伪装成文件流" href=https://Kyle-Derrick.github.io/zh/posts/tech/system_level/%E5%86%85%E5%AD%98%E7%BC%93%E5%86%B2%E5%8C%BA%E4%BC%AA%E8%A3%85%E6%96%87%E4%BB%B6%E6%B5%81/></a></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>